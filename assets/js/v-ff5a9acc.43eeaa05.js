(self.webpackChunkgordan404wiki=self.webpackChunkgordan404wiki||[]).push([[2871],{6447:(n,s,a)=>{"use strict";a.r(s),a.d(s,{data:()=>t});const t={key:"v-ff5a9acc",path:"/interview/vue.html",title:"前端面试指北",lang:"zh-CN",frontmatter:{sidebar:"auto"},excerpt:"",headers:[{level:2,title:"VUE相关面试题",slug:"vue相关面试题",children:[{level:3,title:"MVC 和 MVVM 区别",slug:"mvc-和-mvvm-区别",children:[]},{level:3,title:"Vue2.0 响应式数据的原理",slug:"vue2-0-响应式数据的原理",children:[]},{level:3,title:"使用Object.defineProperty 缺点",slug:"使用object-defineproperty-缺点",children:[]},{level:3,title:"Vue 如何检测数组变化",slug:"vue-如何检测数组变化",children:[]},{level:3,title:"响应式系统的依赖收集追踪原理",slug:"响应式系统的依赖收集追踪原理",children:[]},{level:3,title:"虚拟 DOM 优缺点",slug:"虚拟-dom-优缺点",children:[]},{level:3,title:"Vue diff 算法",slug:"vue-diff-算法",children:[]},{level:3,title:"Vue的template编译",slug:"vue的template编译",children:[]},{level:3,title:"Vue 组件的渲染和更新过程",slug:"vue-组件的渲染和更新过程",children:[]},{level:3,title:"为什么 data 是一个函数",slug:"为什么-data-是一个函数",children:[]},{level:3,title:"组件中写name选项有什么作用",slug:"组件中写name选项有什么作用",children:[]},{level:3,title:"v-if 和 v-show 的区别",slug:"v-if-和-v-show-的区别",children:[]},{level:3,title:"computed和watch的区别",slug:"computed和watch的区别",children:[]},{level:3,title:"v-if 与 v-for 为什么不建议一起使用",slug:"v-if-与-v-for-为什么不建议一起使用",children:[]},{level:3,title:"v-for 为什么要加 唯一的key",slug:"v-for-为什么要加-唯一的key",children:[]},{level:3,title:"Vue组件通信",slug:"vue组件通信",children:[]},{level:3,title:"组件生命周期",slug:"组件生命周期",children:[]},{level:3,title:"父子组件的渲染顺序",slug:"父子组件的渲染顺序",children:[]},{level:3,title:"keep-alive 使用场景和原理",slug:"keep-alive-使用场景和原理",children:[]},{level:3,title:"$nextTick 原理和使用场景",slug:"nexttick-原理和使用场景",children:[]},{level:3,title:"Vue.mixin 的使用场景和原理",slug:"vue-mixin-的使用场景和原理",children:[]},{level:3,title:"Vue.extend 作用和原理",slug:"vue-extend-作用和原理",children:[]},{level:3,title:"Vue自定义指令作用和原理",slug:"vue自定义指令作用和原理",children:[]},{level:3,title:"VUEX",slug:"vuex",children:[]},{level:3,title:"vue-router 路由模式有几种？",slug:"vue-router-路由模式有几种",children:[]},{level:3,title:"Proxy 和 Reflect 作用和使用",slug:"proxy-和-reflect-作用和使用",children:[]},{level:3,title:"Vue3.0 Proxy实现响应式原理",slug:"vue3-0-proxy实现响应式原理",children:[]},{level:3,title:"Vue3.0 Proxy 和 defineProperty 对比",slug:"vue3-0-proxy-和-defineproperty-对比",children:[]},{level:3,title:"Vue3.0",slug:"vue3-0",children:[]}]}],filePathRelative:"interview/vue.md",git:{updatedTime:1631627466e3,contributors:[{name:"lishuaixingNewBee",email:"vae.china@foxmail.com",commits:11}]}}},5726:(n,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>Qs});var t=a(4057);const o=a.p+"assets/img/23.b9190f4d.png",e=a.p+"assets/img/24.9c5af321.jpeg",c=a.p+"assets/img/25.2a391781.png",p=a.p+"assets/img/27.1258b810.png",k=a.p+"assets/img/28.b33f3cb9.png",l=a.p+"assets/img/29.81e1cd82.png",u=a.p+"assets/img/30.54444665.png",m=a.p+"assets/img/31.98ec5da8.png",W=a.p+"assets/img/32.12a17c91.png",i=a.p+"assets/img/21.862bafaf.png",r=(0,t.Wm)("h1",{id:"前端面试指北",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#前端面试指北","aria-hidden":"true"},"#"),(0,t.Uk)(" 前端面试指北")],-1),U=(0,t.Wm)("h2",{id:"vue相关面试题",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue相关面试题","aria-hidden":"true"},"#"),(0,t.Uk)(" VUE相关面试题")],-1),d=(0,t.Uk)("强烈建议阅读"),v={href:"/vueAnalysis/introduction/",target:"_blank",rel:"noopener noreferrer"},h=(0,t.Uk)("Vue源码分析"),y=(0,t.Wm)("h3",{id:"mvc-和-mvvm-区别",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#mvc-和-mvvm-区别","aria-hidden":"true"},"#"),(0,t.Uk)(" MVC 和 MVVM 区别")],-1),f=(0,t.Wm)("h4",{id:"背景及概念",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#背景及概念","aria-hidden":"true"},"#"),(0,t.Uk)(" 背景及概念")],-1),w=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"第一阶段，直接用JavaScript操作DOM节点，使用浏览器提供的原生API"),(0,t.Wm)("li",null,"第二阶段，由于原生API不好用，还要考虑浏览器兼容性，jQuery的出现风靡一时"),(0,t.Wm)("li",null,"第三阶段，MVC模式，需要服务器端配合，JavaScript可以在前端修改服务器渲染后的数据。"),(0,t.Wm)("li",null,"第四阶段，随着前端页面越来越复杂，用户对于交互性要求也越来越高，仅仅用jQuery是远远不够的，MVVM模型应运而生")])],-1),g=(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:o,alt:"MVC"})],-1),b=(0,t.Wm)("h4",{id:"mvc",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#mvc","aria-hidden":"true"},"#"),(0,t.Uk)(" MVC")],-1),x=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"MVC 全名是 Model View Controller，是模型(model)－视图(view)－控制器(controller)的缩写，一种软件设计典范(例如:JSP、asp、php)"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"Model（模型）：是应用程序中用于处理应用程序数据逻辑的部分。通常模型对象负责在数据库中存取数据"),(0,t.Wm)("li",null,"View（视图）：是应用程序中处理数据显示的部分。通常视图是依据模型数据创建的"),(0,t.Wm)("li",null,"Controller（控制器）：是应用程序中处理用户交互的部分。通常控制器负责从视图读取数据，控制用户输入，并向模型发送数据")]),(0,t.Wm)("p",null,[(0,t.Wm)("strong",null,"MVC 的思想"),(0,t.Uk)("：一句话描述就是 Controller 负责将 Model 的数据用 View 显示出来，换句话说就是在 Controller 里面把 Model 的数据赋值给 View。缺点:如果需要更新视图还需要依赖手动操作DOM，如实用JQ。")])],-1),V=(0,t.Wm)("h4",{id:"mvvm",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#mvvm","aria-hidden":"true"},"#"),(0,t.Uk)(" MVVM")],-1),j=(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:e,alt:"MVVM"})],-1),C=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"是指数据层（Model）-视图层（View）-数据视图（ViewModel）的响应式框架。它包括")]),(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,"修改View层，Model对应数据发生变化"),(0,t.Wm)("li",null,"Model数据变化，不需要查找DOM，直接更新View")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"MVVM 与 MVC 最大的区别就是：它实现了 View 和 Model 的自动同步，也就是当 Model 的属性改变时，我们不用再自己手动操作 Dom 元素，来改变 View 的显示，而是改变属性后该属性对应 View 层显示会自动改变（对应Vue数据驱动的思想） 整体看来，MVVM 比 MVC 精简很多，不仅简化了业务与界面的依赖，还解决了数据频繁更新的问题，不用再用选择器操作 DOM 元素。因为在 MVVM 中，View 不知道 Model 的存在，Model 和 ViewModel 也观察不到 View，这种低耦合模式提高代码的可重用性")])],-1),O=(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:c,alt:"MVVM"})],-1),M=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"注意：Vue 并没有完全遵循 MVVM 的思想 这一点官网自己也有说明 那么问题来了 为什么官方要说 Vue 没有完全遵循 MVVM 思想呢？"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"严格的 MVVM 要求 View 不能和 Model 直接通信，而 Vue 提供了$refs 这个属性，让 Model 可以直接操作 View，违反了这一规定，所以说 Vue 没有完全遵循 MVVM。")])],-1),I=(0,t.Wm)("h3",{id:"vue2-0-响应式数据的原理",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue2-0-响应式数据的原理","aria-hidden":"true"},"#"),(0,t.Uk)(" Vue2.0 响应式数据的原理")],-1),S=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"简版"),(0,t.Wm)("p",null,"整体思路是数据劫持+观察者模式"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("用"),(0,t.Wm)("code",null,"observe"),(0,t.Uk)("方法对象进行递归遍历至基本数据类型,包括子属性对象的属性，都加上 setter和getter 这样的话,对象内部通过 "),(0,t.Wm)("code",null,"defineReactive"),(0,t.Uk)(" 方法，使用 "),(0,t.Wm)("code",null,"Object.defineProperty"),(0,t.Uk)(" 将属性进行劫持（只会劫持已经存在的属性），数组则是通过重写数组方法来实现。当页面使用对应属性时，每个属性都拥有自己的 "),(0,t.Wm)("code",null,"dep"),(0,t.Uk)(" 属性，存放他所依赖的 "),(0,t.Wm)("code",null,"watcher"),(0,t.Uk)("（依赖收集），当属性变化后会通知自己对应的 "),(0,t.Wm)("code",null,"watcher"),(0,t.Uk)(" 去更新(派发更新)。")])])],-1),D=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"完整版"),(0,t.Wm)("p",null,"vue.js 是采用数据劫持结合发布者-订阅者模式的方式，通过Object.defineProperty()来劫持各个属性的setter，getter，在数据变动时发布消息给订阅者，触发相应的监听回调。"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("第一步：需要observe方法将数据对象进行递归遍历，包括子属性对象的属性，使用 "),(0,t.Wm)("code",null,"Object.defineProperty"),(0,t.Uk)(" 都加上 setter和getter这样的话，给这个对象的某个值赋值，就会触发setter，那么就能监听到了数据变化")]),(0,t.Wm)("li",null,"第二步：compile解析模板指令，将模板中的变量替换成数据，然后初始化渲染页面视图，并将每个指令对应的节点绑定更新函数，添加监听数据的订阅者,一旦数据有变动，收到通知，更新视图"),(0,t.Wm)("li",null,"第三步：Watcher订阅者是Observer和Compile之间通信的桥梁，主要做的事情是:")]),(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,"在自身实例化时往属性订阅器(dep)里面添加自己"),(0,t.Wm)("li",null,"自身必须有一个update()方法"),(0,t.Wm)("li",null,"待属性变动dep.notice()通知时，能调用自身的update()方法，并触发Compile中绑定的回调，则功成身退。")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"第四步：MVVM作为数据绑定的入口，整合Observer、Compile和Watcher三者，通过Observer来监听自己的model数据变化，通过Compile来解析编译模板指令，最终利用Watcher搭起Observer和Compile之间的通信桥梁，达到数据变化 -> 视图更新；视图交互变化(input) -> 数据model变更的双向绑定效果。")])],-1),P=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token comment"},"// 简易版和源码略有差异"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 监听对象的属性"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" oldArrayProto "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Array"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("prototype"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 然后将arrayMethods继承自数组原型"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 这里是面向切片编程思想（AOP）--不破坏封装的前提下，动态的扩展功能"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" arrayMethods "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" Object"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"create"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldArrayProto"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" methodNames "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token string"},'"push"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("     "),(0,t.Wm)("span",{class:"token comment"},"// 末尾添加"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token string"},'"pop"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("      "),(0,t.Wm)("span",{class:"token comment"},"// 删除添加"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token string"},'"shift"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("    "),(0,t.Wm)("span",{class:"token comment"},"// 开口删除"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token string"},'"unshift"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("  "),(0,t.Wm)("span",{class:"token comment"},"// 开头添加"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token string"},'"splice"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("   "),(0,t.Wm)("span",{class:"token comment"},"// 添加或删除"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token string"},'"reverse"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("  "),(0,t.Wm)("span",{class:"token comment"},"// 反转"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token string"},'"sort"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("     "),(0,t.Wm)("span",{class:"token comment"},"// 排序"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  methodNames"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"forEach"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"method"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 重写数组方法"),(0,t.Uk)("\n    arrayMethods"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("method"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"updateView"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 触发视图更新"),(0,t.Uk)("\n      oldArrayProto"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("method"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"call"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"..."),(0,t.Uk)("arguments"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"//"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"observer"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"target"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"typeof"),(0,t.Uk)(" target "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'object'"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"||"),(0,t.Uk)(" target "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 不是对象或者数组"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" target\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("Array"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"isArray"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 如果是数组特殊 处理"),(0,t.Uk)("\n      target"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("__proto__ "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" arrayMethods"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 修改原型指向"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    Object"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"keys"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"forEach"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"key"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"defineReactive"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" target"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"defineReactive"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("obj"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" val")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"observer"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("val"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 实现深度监听"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// Object.defineProperty(arr, index, { // 可监听到下标改变，监听不到push、length等原方法属性"),(0,t.Uk)("\n    Object"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"defineProperty"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("obj"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      enumerable"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"true"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("  "),(0,t.Wm)("span",{class:"token comment"},"/* 属性可枚举 */"),(0,t.Uk)("\n      configurable"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"true"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token comment"},"/* 属性可被修改或删除 */"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function-variable function"},"get"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"reactiveGetter"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'__get:'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" val"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" val"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" \n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function-variable function"},"set"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"reactiveSetter"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"newVal"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'__set:'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token template-string"},[(0,t.Wm)("span",{class:"token template-punctuation string"},"`"),(0,t.Wm)("span",{class:"token interpolation"},[(0,t.Wm)("span",{class:"token interpolation-punctuation punctuation"},"${"),(0,t.Uk)("val"),(0,t.Wm)("span",{class:"token interpolation-punctuation punctuation"},"}")]),(0,t.Wm)("span",{class:"token string"},"=>"),(0,t.Wm)("span",{class:"token interpolation"},[(0,t.Wm)("span",{class:"token interpolation-punctuation punctuation"},"${"),(0,t.Uk)("newVal"),(0,t.Wm)("span",{class:"token interpolation-punctuation punctuation"},"}")]),(0,t.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newVal "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(" val"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//值不变才调用更新"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"//深度监听,如果set修改值不再次调用observer监听，当把 data.age = 1 => data.age = { num: 1}改变数据类型,就永远无法监听到num。"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token function"},"observer"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newVal"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// val是在闭包中的，此处设置完之后，再get也是会获取最新的值"),(0,t.Uk)("\n        val "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newVal\n        "),(0,t.Wm)("span",{class:"token function"},"updateView"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newVal"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"updateView"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"params"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 更新视图"),(0,t.Uk)("\n    console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'视图更新:'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" params"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" data "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    name"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'goudanlee'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    info"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      address"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'曹县'"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    age"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"17"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    list"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"observer"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("data"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  data"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("name "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'goudanlee2'"),(0,t.Uk)("\n  data"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("x "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"100"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 新增属性监听不到所以有Vue.set"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"delete"),(0,t.Uk)(" data"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("name "),(0,t.Wm)("span",{class:"token comment"},"// 删除属性监听不到所以有Vue.delete"),(0,t.Uk)("\n  data"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("info"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("address "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'北京'"),(0,t.Uk)("\n  data"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("age "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    num"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"21"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  data"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("age"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("num "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"22"),(0,t.Uk)("\n  data"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("list"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"3"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 可监听到"),(0,t.Uk)("\n  data"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("list"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"push"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 通过重写数组方法才可监听到"),(0,t.Uk)("\n")])])],-1),E=(0,t.Wm)("h3",{id:"使用object-defineproperty-缺点",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#使用object-defineproperty-缺点","aria-hidden":"true"},"#"),(0,t.Uk)(" 使用"),(0,t.Wm)("code",null,"Object.defineProperty"),(0,t.Uk)(" 缺点")],-1),T=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"深度监听，需要递归到底，如果源数据大且嵌套层级深、一次性计算量大。"),(0,t.Wm)("li",null,"无法监听新增/删除属性(Vue.set/Vue.delete)"),(0,t.Wm)("li",null,"无法监听整个数组变化,可监听到数组下标改变，但无法原生监听数组(push、pop、length)，需要特俗处理")])],-1),A=(0,t.Wm)("h3",{id:"vue-如何检测数组变化",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue-如何检测数组变化","aria-hidden":"true"},"#"),(0,t.Uk)(" Vue 如何检测数组变化")],-1),L=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,[(0,t.Wm)("code",null,"Object.defineProperty"),(0,t.Uk)(" 可监听到数组下标改变，无法原生监听数组(push、pop、length),考虑性能原因没有用 defineProperty 对数组的每一项进行拦截，而是选择对 7 种数组（push,shift,pop,splice,unshift,sort,reverse）方法进行重写(AOP 切片思想) 所以在 Vue 中修改数组的索引和长度是无法监控到的。需要通过以上 7 种变异方法修改数组才会触发数组对应的 watcher 进行更新")])],-1),q=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token comment"},"// src/obserber/array.js"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 先保留数组原型"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" arrayProto "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Array"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("prototype"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 然后将arrayMethods继承自数组原型"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 这里是面向切片编程思想（AOP）--不破坏封装的前提下，动态的扩展功能"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" arrayMethods "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" Object"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"create"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("arrayProto"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" methodsToPatch "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token string"},'"push"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token string"},'"pop"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token string"},'"shift"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token string"},'"unshift"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token string"},'"splice"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token string"},'"reverse"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token string"},'"sort"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\nmethodsToPatch"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"forEach"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"method"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  arrayMethods"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("method"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Wm)("span",{class:"token operator"},"..."),(0,t.Uk)("args")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"//   这里保留原型方法的执行结果"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" result "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" arrayProto"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("method"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"apply"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" args"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 这句话是关键"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// this代表的就是数据本身 比如数据是{a:[1,2,3]} 那么我们使用a.push(4)  this就是a  ob就是a.__ob__ 这个属性就是上段代码增加的 代表的是该数据已经被响应式观察过了指向Observer实例"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" ob "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("__ob__"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n    "),(0,t.Wm)("span",{class:"token comment"},"// 这里的标志就是代表数组有新增操作"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" inserted"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"switch"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("method"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"case"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"push"'),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"case"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"unshift"'),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)("\n        inserted "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" args"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"break"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"case"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"splice"'),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)("\n        inserted "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" args"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"slice"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token number"},"2"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"default"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"break"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 如果有新增的元素 inserted是一个数组 调用Observer实例的observeArray对数组每一项进行观测"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("inserted"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" ob"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"observeArray"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("inserted"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 之后咱们还可以在这里检测到数组改变了之后从而触发视图更新的操作--后续源码会揭晓"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" result"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n")])])],-1),X=(0,t.Wm)("h3",{id:"响应式系统的依赖收集追踪原理",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#响应式系统的依赖收集追踪原理","aria-hidden":"true"},"#"),(0,t.Uk)(" 响应式系统的依赖收集追踪原理")],-1),N=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"在拦截器(Object.defineProperty)里，在它的闭包中会有一个观察者(Dep)对象，这个对象用来存放被观察者(watcher)的实例。 并且拦截器注册 get 方法，该方法用来进行「依赖收集」。其实「依赖收集」的过程就是把 Watcher 实例存放到对应的 Dep 对象中去。 get 方法可以让当前的 Watcher 对象（Dep.target）存放到它的 subs 中（addSub）方法，在数据变化时，set 会调用 Dep 对象的 notify 方法通知它内部所有的 Wathcer 对象进行视图更新。")],-1),F=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"Dep用于依赖收集,他是依赖收集的容器")],-1),H=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token comment"},"// Dep 对象用于依赖收集，它实现了一个发布订阅模式，完成了数据 Data 和渲染视图 Watcher 的订阅"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" uid "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Dep"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 根据 ts 类型提示，我们可以得出 Dep.target 是一个 Watcher 类型。"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"static"),(0,t.Uk)(" target"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)("Watcher"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// subs 存放搜集到的 Watcher 对象集合"),(0,t.Uk)("\n  subs"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" Array"),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)("Watcher"),(0,t.Wm)("span",{class:"token operator"},">"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"constructor"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("subs "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 存放所有订阅数据的Watcher"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("id "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" uid"),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"addSub"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("sub"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" Watcher")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 搜集所有使用到这个 data 的 Watcher 对象。"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("subs"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"push"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("sub"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"depend"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("Dep"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//  Dep.target当前渲染的watcher"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 搜集依赖，最终会调用上面的 addSub 方法"),(0,t.Uk)("\n      Dep"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addDep"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"notify"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" subs "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("subs"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"slice"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" i "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" l "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" subs"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" i "),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)(" l"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" i"),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 调用对应的 Watcher，更新视图"),(0,t.Uk)("\n      subs"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"update"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])])],-1),z=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"defineReactive")],-1),R=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"defineReactive"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("obj"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" val")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 为每个属性创建 Dep（依赖搜集的容器，后文会讲）"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" dep "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Dep"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 绑定 get、set"),(0,t.Uk)("\n  Object"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"defineProperty"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("obj"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" value "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" val"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 如果有 target 标识，则进行依赖搜集"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("Dep"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        dep"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"depend"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" value"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"set"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newVal"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      val "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newVal"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 修改数据时，通知页面重新渲染"),(0,t.Uk)("\n      dep"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"notify"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])])],-1),K=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"Watcher")],-1),Y=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Watcher"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"constructor"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("vm"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" Component"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" expOrFn"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" string "),(0,t.Wm)("span",{class:"token operator"},"|"),(0,t.Uk)(" Function")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 将 vm._render 方法赋值给 getter。"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 这里的 expOrFn 其实就是 vm._render，后文会讲到。"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("getter "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" expOrFn"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("value "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 给 Dep.target 赋值为当前 Watcher 对象"),(0,t.Uk)("\n    Dep"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("target "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// this.getter 其实就是 vm._render"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// vm._render 用来生成虚拟 dom、执行 dom-diff、更新真实 dom。"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" value "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"getter"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"call"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("vm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("vm"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" value"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"addDep"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("dep"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" Dep")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 将当前的 Watcher 添加到 Dep 收集池中"),(0,t.Uk)("\n    dep"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addSub"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"update"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 开启异步队列，批量更新 Watcher"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"queueWatcher"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"run"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 和初始化一样，会调用 get 方法，更新视图"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" value "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])])],-1),Z=(0,t.Wm)("h3",{id:"虚拟-dom-优缺点",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#虚拟-dom-优缺点","aria-hidden":"true"},"#"),(0,t.Uk)(" 虚拟 DOM 优缺点")],-1),G=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"由于在浏览器中操作 DOM 是很昂贵的。频繁的操作 DOM，会产生一定的性能问题。这就是虚拟 Dom 的产生原因。Vue2 的 Virtual DOM 借鉴了开源库 snabbdom 的实现。Virtual DOM 本质就是用一个原生的 JS 对象去描述一个 DOM 节点，是对真实 DOM 的一层抽象。")],-1),B=(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:p,alt:"Virtual DOM"})],-1),J=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"class"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"VNode"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"constructor"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("tag"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" data"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" children"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" text"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" elm")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"/*当前节点的标签名*/"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("tag "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" tag"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"/*当前节点的一些数据信息，比如props、attrs等数据*/"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("data "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" data"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"/*当前节点的子节点，是一个数组*/"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("children "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" children"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"/*当前节点的文本*/"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" text"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"/*当前虚拟节点对应的真实dom节点*/"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" elm"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\nvm"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"$createElement"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'div'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("attrs"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("id"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Wm)("span",{class:"token string"},"'app'"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'内容'"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"||"),(0,t.Uk)(" children"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\nReact"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"createElement"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"h1"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("className"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"main"'),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"内容"'),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"||"),(0,t.Uk)(" children"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n")])])],-1),Q=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("strong",null,"优点：")])],-1),_=(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,"保证性能下限：避免频繁操作DOM，频繁操作DOM会可能让浏览器回流和重绘，性能也会非常低，还有就是手动操作 DOM 还是比较麻烦的，要考虑浏览器兼容性问题，当前jQuery等库简化了 DOM操作，但是项目复杂了，DOM操作还是会变得复杂，虚拟DOM改变了当前的状态不需要立即的去更新DOM，过前后两次差异进行比较寻求最小或者局部更新，或者把多次合并成一次。"),(0,t.Wm)("li",null,"无需手动操作 DOM： 我们不再需要手动去操作 DOM，只需要写好 View-Model 的代码逻辑，框架会根据虚拟 DOM 和 数据双向绑定，帮我们以可预期的方式更新视图，极大提高我们的开发效率；"),(0,t.Wm)("li",null,"跨平台： 虚拟 DOM 本质上是 JavaScript 对象,而 DOM 与平台强相关，相比之下虚拟 DOM 可以进行更方便地跨平台操作，例如服务器渲染、weex 开发等等。")],-1),$=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("strong",null,"缺点:")])],-1),nn=(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,"无法进行极致优化： 虽然虚拟 DOM + 合理的优化，足以应对绝大部分应用的性能需求，但在一些性能要求极高的应用中虚拟 DOM 无法进行针对性的极致优化。"),(0,t.Wm)("li",null,"首次渲染大量 DOM 时，由于多了一层虚拟 DOM 的计算，会比 innerHTML 插入慢。")],-1),sn=(0,t.Wm)("h3",{id:"vue-diff-算法",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue-diff-算法","aria-hidden":"true"},"#"),(0,t.Uk)(" Vue diff 算法")],-1),an=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"diff即对比，是一广泛的概念，如linux diff命令、git diff 等,两棵树做diff就如同vdom diff 原本diff 复杂度 O (n^3) ，1000 个节点的树，要比对 10 亿次，性能消耗太大，算法不可用，vdom diff用了以下的方式优化后时间复杂度到 O (n) 级别。"),(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,"只比较同一层级，不跨域级比较"),(0,t.Wm)("li",null,"tag不相同，则直接删除重建，不再深度比较"),(0,t.Wm)("li",null,"tag 和 key,两者都相同，则认为是相同节点，不再深度比较")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("上面的方式可以说是偷懒或者比较暴力，但是对于dom非常合适，能解决80%的场景，且性能好。 代码总结：按照上面规则 走"),(0,t.Wm)("code",null,"patch"),(0,t.Uk)("方法做同级比较、 再用"),(0,t.Wm)("code",null,"sameVnode"),(0,t.Uk)("方法判断是否继续走"),(0,t.Wm)("code",null,"patchVnode"),(0,t.Uk)("方法，在"),(0,t.Wm)("code",null,"patchVnode"),(0,t.Uk)("方法中"),(0,t.Wm)("code",null,"oldVnode.children"),(0,t.Uk)("和"),(0,t.Wm)("code",null,"Vnode.children"),(0,t.Uk)("都存在并且不同就调用"),(0,t.Wm)("code",null,"updateChildren"),(0,t.Uk)("方法")])])],-1),tn=(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:k,alt:"VUE"})],-1),on=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token doc-comment comment"},[(0,t.Uk)("/**\n * 把传入的 参数 作为 对象返回\n * "),(0,t.Wm)("span",{class:"token keyword"},"@param"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},[(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("string"),(0,t.Wm)("span",{class:"token punctuation"},"}")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token parameter"},"sel"),(0,t.Uk)(" 选择器\n * "),(0,t.Wm)("span",{class:"token keyword"},"@param"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},[(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("object"),(0,t.Wm)("span",{class:"token punctuation"},"}")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token parameter"},"data"),(0,t.Uk)(" 数据\n * "),(0,t.Wm)("span",{class:"token keyword"},"@param"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},[(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("array"),(0,t.Wm)("span",{class:"token punctuation"},"}")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token parameter"},"children"),(0,t.Uk)(" 子节点 children和text不会共存\n * "),(0,t.Wm)("span",{class:"token keyword"},"@param"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},[(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("string"),(0,t.Wm)("span",{class:"token punctuation"},"}")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token parameter"},"text"),(0,t.Uk)(" 文本\n * "),(0,t.Wm)("span",{class:"token keyword"},"@param"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},[(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("dom"),(0,t.Wm)("span",{class:"token punctuation"},"}")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token parameter"},"elm"),(0,t.Uk)(" DOM\n * "),(0,t.Wm)("span",{class:"token keyword"},"@returns"),(0,t.Uk)(" object\n */")]),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"default"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("sel"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" data"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" children"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" text"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" elm")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" sel"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" data"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" children"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" text"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" elm "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 第一次只有vnode,没有oldvnode会直接走 createElm()"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  sel"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 标签选择器"),(0,t.Uk)("\n  data"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 数据"),(0,t.Uk)("\n  children"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 是否有子元素 children和text不能共存"),(0,t.Uk)("\n  text"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 文本"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n")])])],-1),en=(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:l,alt:"patch"})],-1),cn=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("strong",null,"一、写个基础的patch")])],-1),pn=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"import"),(0,t.Uk)(" vnode "),(0,t.Wm)("span",{class:"token keyword"},"from"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'./vnode'"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 导出 patch"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token doc-comment comment"},[(0,t.Uk)("/**\n * "),(0,t.Wm)("span",{class:"token keyword"},"@param"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},[(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("vnode/DOM"),(0,t.Wm)("span",{class:"token punctuation"},"}")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token parameter"},"oldVnode"),(0,t.Uk)("\n * "),(0,t.Wm)("span",{class:"token keyword"},"@param"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},[(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("vnode"),(0,t.Wm)("span",{class:"token punctuation"},"}")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token parameter"},"newVnode"),(0,t.Uk)("\n */")]),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"default"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"patch"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newVnode")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 1.判断oldVnode 是否为虚拟 DOM 这里判断是否有 sel"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("sel"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 转为虚拟DOM"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 给一个参数不是vnode,创建一个空的vnode,关联到这个DOM元素"),(0,t.Uk)("\n    oldVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"emptyNodeAt"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 判断 oldVnode 和 newVnode 是否为同一虚拟节点"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 通过 key 和 sel 进行判断"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"sameVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 是同一个虚拟节点 调用我们写的 patchVnode.js 中的方法"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 走深度比对"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"patchVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token operator"},"..."),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 不是同一虚拟个节点 直接暴力拆掉老节点，重建新的节点"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" oEl "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("el "),(0,t.Wm)("span",{class:"token comment"},"// 当前oldVnode对应的真实元素节点"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" parentEle "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"parentNode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oEl"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("  "),(0,t.Wm)("span",{class:"token comment"},"// 父元素"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"createEle"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("vnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("  "),(0,t.Wm)("span",{class:"token comment"},"// 根据Vnode生成新元素"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parentEle "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"insertBefore"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parentEle"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("el"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"nextSibling"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oEl"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 将新元素添加进父元素"),(0,t.Uk)("\n        api"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"removeChild"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parentEle"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("el"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("  "),(0,t.Wm)("span",{class:"token comment"},"// 移除以前的旧元素节点"),(0,t.Uk)("\n        oldVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token operator"},"..."),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 新的Vnode变成老的Vnode"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// newVnode.elm = oldVnode.elm"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 返回newVnode作为 旧的虚拟节点"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" newVnode\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 判断两节点是否值得深度比较，值得比较则执行patchVnode"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"sameVnode"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("a"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" b")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 都不传key,key === undefiend // true,就会走后面的判断"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("\n    a"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("key "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(" b"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("key "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)("  "),(0,t.Wm)("span",{class:"token comment"},"// key值"),(0,t.Uk)("\n    a"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("tag "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(" b"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("tag "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)("  "),(0,t.Wm)("span",{class:"token comment"},"// 标签名"),(0,t.Uk)("\n    a"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("isComment "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(" b"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("isComment "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)("  "),(0,t.Wm)("span",{class:"token comment"},"// 是否为注释节点"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 是否都定义了data，data包含一些具体信息，例如onclick , style"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"isDef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("a"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("data"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"isDef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("b"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("data"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)("  \n    "),(0,t.Wm)("span",{class:"token function"},"sameInputType"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("a"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" b"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 当标签是<input>的时候，type必须相同"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token doc-comment comment"},[(0,t.Uk)("/**\n * 转为 虚拟 DOM\n * "),(0,t.Wm)("span",{class:"token keyword"},"@param"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},[(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("DOM"),(0,t.Wm)("span",{class:"token punctuation"},"}")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token parameter"},"elm"),(0,t.Uk)(" DOM节点\n * "),(0,t.Wm)("span",{class:"token keyword"},"@returns"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},[(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("object"),(0,t.Wm)("span",{class:"token punctuation"},"}")]),(0,t.Uk)("\n */")]),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"emptyNodeAt"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"elm"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 把 sel 和 elm 传入 vnode 并返回"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 这里主要选择器给转小写返回vnode"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 这里功能做的简陋，没有去解析 # ."),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// data 也可以传 ID 和 class"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 会把vnode和真实的dom做一绑定，否则不知道最后插入到哪去"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"vnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("tagName"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"toLowerCase"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" elm"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])])],-1),kn=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("strong",null,"二、patchVnode")])],-1),ln=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"patchVnode"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 一、判断是否相同对象"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 下面的这种情况也比较简单，在当新老 VNode 节点都是 isStatic（静态的），并且 key 相同时，只要将 componentInstance 与 elm 从老 VNode 节点“拿过来”即可。这里的 isStatic 也就是前面提到过的「编译」的时候会将静态节点标记出来，这样就可以跳过比对的过程。"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("isStatic "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(" oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("isStatic "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("key "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(" oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("componentInstance "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("componentInstance"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 连等赋值,把新 oldVnode.elm 设置给新的vnode.elm，这样就能知道关联到哪个真实dom"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" elm "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" oldCh "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("children"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" ch "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("children"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 二、判断newVnode上有没有text"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 这里为啥不考虑 oldVnode呢，因为 newVnode有text说明就没children, children和text不会共存"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 当新 VNode 节点是文本节点的时候，直接用 setTextContent 来设置 text，这里的 nodeOps 是一个适配层，根据不同平台提供不同的操作平台 DOM 的方法，实现跨平台。"),(0,t.Uk)("\n    nodeOps"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"setTextContent"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" \n    "),(0,t.Wm)("span",{class:"token comment"},"// 1.新、旧节都有children 2. 新节点且有children，旧节点无children有text 2.只有旧节点且是text、3.只有旧节点且有children"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 1.oldCh 与 ch 都存在且不相同时，使用 updateChildren 函数来更新子节点，这个后面重点讲。"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldCh "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(" ch "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldCh "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(" ch"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"updateChildren"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" ch"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 2.新children有，旧children无（旧text有直接清空），然后将 ch 批量插入插入到节点elm下。"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("ch"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 如果旧text有值直接清空"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" nodeOps"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"setTextContent"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"''"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 添加新children"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"addVnodes"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" ch"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" ch"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length "),(0,t.Wm)("span",{class:"token operator"},"-"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 3.同理当只有 旧children有，新children无，老节点通过 removeVnodes 全部清除"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldCh"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"removeVnodes"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length "),(0,t.Wm)("span",{class:"token operator"},"-"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 4.旧text有值，全部清空"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("text"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      nodeOps"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"setTextContent"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"''"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])])],-1),un=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Wm)("strong",null,"三、updateChildren"),(0,t.Wm)("img",{src:u,alt:"updateChildren"})])],-1),mn=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"updateChildren"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("parentElm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newCh")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" oldStartIdx "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" newStartIdx "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" oldEndIdx "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length "),(0,t.Wm)("span",{class:"token operator"},"-"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" oldStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" oldEndVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("oldEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" newEndIdx "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length "),(0,t.Wm)("span",{class:"token operator"},"-"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" newStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" newEndVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("newEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" oldKeyToIdx"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" idxInOld"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" elmToMove"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" refElm"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n    "),(0,t.Wm)("span",{class:"token keyword"},"while"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldStartIdx "),(0,t.Wm)("span",{class:"token operator"},"<="),(0,t.Uk)(" oldEndIdx "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(" newStartIdx "),(0,t.Wm)("span",{class:"token operator"},"<="),(0,t.Uk)(" newEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Uk)("oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            oldStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("oldStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Uk)("oldEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            oldEndVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"--"),(0,t.Uk)("oldEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 1.新头旧头"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"sameVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token function"},"patchVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n            oldStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("oldStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n            newStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("newStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 2.新尾旧尾"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"sameVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token function"},"patchVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n            oldEndVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"--"),(0,t.Uk)("oldEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n            newEndVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"--"),(0,t.Uk)("newEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 3.旧头新尾:真实dom中的第一个节点会移到最后"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"sameVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token function"},"patchVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n            nodeOps"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"insertBefore"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parentElm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" nodeOps"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"nextSibling"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n            oldStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("oldStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n            newEndVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"--"),(0,t.Uk)("newEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 4.旧尾新头: 真实dom中的最后一个节点会移到最前，匹配上的两个指针向中间移动"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"sameVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token function"},"patchVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n            nodeOps"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"insertBefore"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parentElm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldEndVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n            oldEndVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"--"),(0,t.Uk)("oldEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n            newStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("newStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token comment"},"// 以上四种方式都没命中"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token comment"},"// 如果四种匹配没有一对是成功的，那么遍历oldChild，newStartVnode挨个和他们匹配，匹配成功就在真实dom中将成功的节点移到最前面，如果依旧没有成功的，那么将newStartVnode对应的节点插入到dom中对应的oldStartIdx位置，oldStartIdx和newStartIdx指针向中间移动。"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" elmToMove "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("idxInOld"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Uk)("oldKeyToIdx"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" oldKeyToIdx "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"createKeyToOldIdx"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldCh"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token comment"},"// 拿新节点的key，能否对应上oldCh 中的某个节点的key"),(0,t.Uk)("\n            idxInOld "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("key "),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)(" oldKeyToIdx"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token comment"},"// key没有对应上就这个位置，直接插入"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Uk)("idxInOld"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// newStartVnode"),(0,t.Uk)("\n                "),(0,t.Wm)("span",{class:"token function"},"createElm"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentElm"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n                newStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("newStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token comment"},"// key 对应上了，用sameVnode 去判断是否相等"),(0,t.Uk)("\n                elmToMove "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("idxInOld"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n                "),(0,t.Wm)("span",{class:"token comment"},"// sameVnode 判断 sel、key都相等直接patchVnode"),(0,t.Uk)("\n                "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"sameVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elmToMove"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n                    "),(0,t.Wm)("span",{class:"token function"},"patchVnode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("elmToMove"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n                    oldCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("idxInOld"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"undefined"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n                    nodeOps"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"insertBefore"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parentElm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n                    newStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("newStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 每次走完，指针累加"),(0,t.Uk)("\n                "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n                    "),(0,t.Wm)("span",{class:"token comment"},"// 不相等 直接创建"),(0,t.Uk)("\n                    "),(0,t.Wm)("span",{class:"token function"},"createElm"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newStartVnode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" parentElm"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n                    newStartVnode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("newStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n                "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("oldStartIdx "),(0,t.Wm)("span",{class:"token operator"},">"),(0,t.Uk)(" oldEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        refElm "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("newEndIdx "),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("newEndIdx "),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("elm "),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token function"},"addVnodes"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parentElm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" refElm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newCh"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" newEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newStartIdx "),(0,t.Wm)("span",{class:"token operator"},">"),(0,t.Uk)(" newEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token function"},"removeVnodes"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parentElm"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldCh"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldStartIdx"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" oldEndIdx"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])])],-1),Wn=(0,t.Wm)("h3",{id:"vue的template编译",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue的template编译","aria-hidden":"true"},"#"),(0,t.Uk)(" Vue的template编译")],-1),rn=(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:m,alt:"template"})],-1),Un=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,[(0,t.Uk)("模板转换成js代码的过程，叫做模板编译 如果是用vue-cli开发并引入"),(0,t.Wm)("code",null,"vue-loader"),(0,t.Uk)("就直接会在开发环境就把template编译为"),(0,t.Wm)("code",null,"render"),(0,t.Uk)("，自己简单尝试可以用"),(0,t.Wm)("code",null,"vue-template-complier"),(0,t.Wm)("code",null,"template"),(0,t.Uk)(" => "),(0,t.Wm)("code",null,"ast"),(0,t.Uk)(" => "),(0,t.Wm)("code",null,"render")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"第一步： 是将 模板字符串 转换成 element ASTs（解析器）"),(0,t.Wm)("li",null,"第二步： 是对 AST 进行静态节点标记，主要用来做虚拟DOM的渲染优化（优化器）"),(0,t.Wm)("li",null,"第三步： 是 使用 element ASTs 生成 render 函数代码字符串（代码生成器）")]),(0,t.Wm)("p",null,[(0,t.Wm)("strong",null,"compile 编译可以分成 parse、optimize 与 generate 三个阶段，最终需要得到 render，执行render函数后，变成vnode")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"parse: 正则等方式将 template 模板中进行字符串解析，得到指令、class、style等数据，形成 AST,就是with语法的过程。"),(0,t.Wm)("li",null,"optimize: 标记 static 静态节点，这是 Vue 在编译过程中的一处优化，后面当 update更新界面时，会有一个 patch 的过程， diff 算法会直接跳过静态节点，从而减少了比较的过程，优化了 patch 的性能"),(0,t.Wm)("li",null,"generate: 会将 AST 转化成 render funtion 字符串，最终得到 render 的字符串以及 staticRenderFns 字符串。")])],-1),dn=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" complier "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"require"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'vue-template-complier'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 插值表达式"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" template "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token template-string"},[(0,t.Wm)("span",{class:"token template-punctuation string"},"`"),(0,t.Wm)("span",{class:"token string"},"<p>{{message}}</p>"),(0,t.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" render "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Function"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"\"with(this) {return _c('p', {attrs: {'id': 'app'}}, [_v('\\n' + _s(message) + '\\n)])}\""),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 插值表达式"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" template "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token template-string"},[(0,t.Wm)("span",{class:"token template-punctuation string"},"`"),(0,t.Wm)("span",{class:"token string"},'\n  <div id="div1" class="container>\n    <img src=""imgUrl"/>\n  </div>\n'),(0,t.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// with(this){"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"//   return _c('div',"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},'//     {staticClass: "containner",attrs: {"id": "div1"}},'),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"//     [_c('img', {attrs: {\"src\": imgUrl}})  ]"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"//   )"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// }"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token comment"},"// 三目运算符"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" template "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token template-string"},[(0,t.Wm)("span",{class:"token template-punctuation string"},"`"),(0,t.Wm)("span",{class:"token string"},"<p>{{show ? '打开' : '关闭'}}</p>"),(0,t.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" render "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Function"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"\"with(this) {return _c('p', {attrs: {'id': 'app'}}, [_v('\\n' + _s(show ？'打开' : '关闭') + '\\n)])}\""),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 循环v-for"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" template "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token template-string"},[(0,t.Wm)("span",{class:"token template-punctuation string"},"`"),(0,t.Wm)("span",{class:"token string"},'\n  <ul>\n    <li v-for="item in list" :key="item.id">{{item.title}}</li>\n  </ul>\n'),(0,t.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// with(this){"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"//   return _c('ul',"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"//     _l((list), function(item){return _c('li', {key: item.id}, [_v(s_(item.title))])})"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"//   )"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// }"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 事件"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" template "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token template-string"},[(0,t.Wm)("span",{class:"token template-punctuation string"},"`"),(0,t.Wm)("span",{class:"token string"},'<button @click="handleclick">submit</button>'),(0,t.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"with"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"_c"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'button'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("on"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Wm)("span",{class:"token string"},'"click"'),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" handleclick"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token function"},"_v"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"submint"'),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// v-model: 绑定input 事件 value重新赋值 $event.target.value 触发set"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" template "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token template-string"},[(0,t.Wm)("span",{class:"token template-punctuation string"},"`"),(0,t.Wm)("span",{class:"token string"},'<input type="text" v-mode="title" />'),(0,t.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token function"},"width"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Wm)("span",{class:"token keyword"},"this")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token function"},"_c"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token string"},"'input'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    directives"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        name"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"model"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n        rawName"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"v-model"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n        value"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("title"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n        expression"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"title"'),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      attrs"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"type"'),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"text"'),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      domProps"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"value"'),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("title"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      on"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token string"},'"input"'),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"$event"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("$event"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("composing"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n          title "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" $event"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("value\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// this = new Vue、 _c = createElement、 _v = createTextVNode、 _s = toStrig, _l = renderList用来做循环"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token template-string"},[(0,t.Wm)("span",{class:"token template-punctuation string"},"`"),(0,t.Wm)("span",{class:"token string"},"createElement ==> Vode"),(0,t.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 用template代替render(render(高)的性能要比tempate(低)要高。)"),(0,t.Uk)("\nVue"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"component"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"h-title"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function-variable function"},"render"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"h"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"h"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token string"},'"h"'),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("level"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n                attrs"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n                    “data"),(0,t.Wm)("span",{class:"token operator"},"-"),(0,t.Uk)("id”"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Wm)("span",{class:"token number"},"10"),(0,t.Uk)("        \n                "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n           "),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("\n             "),(0,t.Wm)("span",{class:"token function"},"createElement"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'a'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n               arrtrs"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n                 name"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'headerId'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n                 href"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"#"'),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"headerId"'),(0,t.Uk)("\n               "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n             "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'this is a tag'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n           "),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    props"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        level"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n            type"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)("String\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n")])])],-1),vn=(0,t.Wm)("h3",{id:"vue-组件的渲染和更新过程",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue-组件的渲染和更新过程","aria-hidden":"true"},"#"),(0,t.Uk)(" Vue 组件的渲染和更新过程")],-1),hn=(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:W,alt:"渲染和更新过程"})],-1),yn=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,"vue 组件初次渲染过程")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("解析模板render函数(或在开发环境使用"),(0,t.Wm)("code",null,"vue-loader"),(0,t.Uk)("已经完成)")]),(0,t.Wm)("li",null,[(0,t.Uk)("触发响应式，监听data属性"),(0,t.Wm)("code",null,"getter"),(0,t.Uk)(),(0,t.Wm)("code",null,"setter"),(0,t.Uk)("(执行render函数就会触发"),(0,t.Wm)("code",null,"getter"),(0,t.Uk)(")")]),(0,t.Wm)("li",null,"执行render函数，生成vnode, patch(element, vnode)")]),(0,t.Wm)("ol",{start:"2"},[(0,t.Wm)("li",null,"vue 组件更新过程")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"修改 data， 触发 setter （此前在getter中已被监听）"),(0,t.Wm)("li",null,"重新执行 render 函数，生成 newVnode"),(0,t.Wm)("li",null,"patch(vnode, newVnode)")])],-1),fn=(0,t.Wm)("div",{class:"language-html ext-html"},[(0,t.Wm)("pre",{class:"language-html"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Uk)("template")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Uk)("p")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("{{name}}"),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Uk)("p")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"</"),(0,t.Uk)("template")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"<"),(0,t.Uk)("script")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Wm)("span",{class:"token script"},[(0,t.Wm)("span",{class:"token language-javascript"},[(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"default"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function"},"data"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      name"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'李狗蛋'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 会触发get"),(0,t.Uk)("\n      city"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'曹县'"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 不会触发get,因为模板中没用到，即和视图无关系"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])]),(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token tag"},[(0,t.Wm)("span",{class:"token punctuation"},"</"),(0,t.Uk)("script")]),(0,t.Wm)("span",{class:"token punctuation"},">")]),(0,t.Uk)("\n")])])],-1),wn=(0,t.Wm)("h3",{id:"为什么-data-是一个函数",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#为什么-data-是一个函数","aria-hidden":"true"},"#"),(0,t.Uk)(" 为什么 data 是一个函数")],-1),gn=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"组件中的 data 写成一个函数，数据以函数返回值形式定义，这样每复用一次组件，就会返回一份新的对象的独立拷贝data，类似于给每个组件实例创建一个私有的数据空间，让各个组件实例维护各自的数据。而单纯的写成对象形式，就使得所有组件实例共用了一份 data，就会造成一个变了全都会变的结果，跟JS的引用类型相关，而非Vue.")],-1),bn=(0,t.Wm)("h3",{id:"组件中写name选项有什么作用",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#组件中写name选项有什么作用","aria-hidden":"true"},"#"),(0,t.Uk)(" 组件中写name选项有什么作用")],-1),xn=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"1、组件keep-alive缓存用name搭配exclude过滤 2、组件递归调用 3、组件安装 4、vue-devtools调试工具name 对应组件名称")],-1),Vn=(0,t.Wm)("h3",{id:"v-if-和-v-show-的区别",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#v-if-和-v-show-的区别","aria-hidden":"true"},"#"),(0,t.Uk)(" v-if 和 v-show 的区别")],-1),jn=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"v-if 在编译过程中会被转化成三元表达式,条件不满足时不渲染此节点。"),(0,t.Wm)("p",null,"v-show 会被编译成指令，条件不满足时控制样式将对应节点隐藏 （display:none）")],-1),Cn=(0,t.Wm)("h3",{id:"computed和watch的区别",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#computed和watch的区别","aria-hidden":"true"},"#"),(0,t.Uk)(" computed和watch的区别")],-1),On=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,[(0,t.Wm)("code",null,"computed"),(0,t.Uk)(" 是计算属性，依赖其他属性计算值，并且 "),(0,t.Wm)("code",null,"computed"),(0,t.Uk)(" 的值有缓存(data里不变还是不会重新计算的)，只有当计算值变化才会返回内容，它可以设置 "),(0,t.Wm)("code",null,"getter"),(0,t.Uk)(" 和 "),(0,t.Wm)("code",null,"setter"),(0,t.Uk)("。")]),(0,t.Wm)("li",null,[(0,t.Uk)("从使用场景上说，"),(0,t.Wm)("code",null,"computed"),(0,t.Uk)("适用一个数据被多个数据影响，而"),(0,t.Wm)("code",null,"watch"),(0,t.Uk)("适用一个数据影响多个数据；")]),(0,t.Wm)("li",null,[(0,t.Wm)("code",null,"computed"),(0,t.Uk)(" 是在"),(0,t.Wm)("code",null,"Dep.update()"),(0,t.Uk)("，执行之后，数据更新之前,watch 是在set刚开始的时候添加回调用，可以监听数据变化情况")]),(0,t.Wm)("li",null,[(0,t.Wm)("code",null,"watch"),(0,t.Uk)("监听引用类型需要设置"),(0,t.Wm)("code",null,"deep:true")])])],-1),Mn=(0,t.Wm)("p",null,[(0,t.Wm)("strong",null,"运用场景：")],-1),In=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"当我们需要进行数值计算，并且依赖于其它数据时，应该使用 computed，因为可以利用 computed 的缓存特性，避免每次获取值时，都要重新计算；"),(0,t.Wm)("li",null,"当我们需要在数据变化时执行异步或开销较大的操作时，应该使用 watch，使用 watch 选项允许我们执行异步操作 ( 访问一个 API )，限制我们执行该操作的频率，并在我们得到最终结果前，设置中间状态。这些都是计算属性无法做到的。")],-1),Sn=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token comment"},"// 先来看看computed最最核心的代码， 脏检查, 执行计算"),(0,t.Uk)("\n "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("watcher"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("dirty"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    watcher"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"evaluate"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n "),(0,t.Wm)("span",{class:"token comment"},"// Dep更新依赖"),(0,t.Uk)("\n "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("Dep"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    watcher"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"depend"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" vm "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    data"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      name"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'狗蛋'"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    computed"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      info"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token function-variable function"},"get"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"调用了getter属性"'),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("name "),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'牛逼'"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token function-variable function"},"set"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"newValue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"调用了settter属性"'),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n          console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("newValue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("name "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'狗蛋Plus'"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("  \n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 第一次访问 `this.name` 的时候, 会调用相应的 get(),记录了依赖项 `name`"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Uk)("、在 computed 初始化的过程中会创建一个 watcher 并设置lazy"),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Wm)("span",{class:"token boolean"},"true"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("所以在初始化时会求值，在页面中调用 computed 时，开始求值，调用 watcher"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"evaluate"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("方法"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("并将 dirty"),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Wm)("span",{class:"token boolean"},"false"),(0,t.Uk)("。\n"),(0,t.Wm)("span",{class:"token number"},"2"),(0,t.Uk)("、当 computed依赖的属性发生改变时，会调用 watcher"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"update"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" 方法，将dirty"),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Wm)("span",{class:"token boolean"},"true"),(0,t.Uk)("。\n"),(0,t.Wm)("span",{class:"token number"},"3"),(0,t.Uk)("、当在页面中再次获取该属性时，会再次调用 如果dirty为 truewatcher"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"evaluate"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" 方法，否则返回原来计算的值。这就是computed 为什么具有缓存效果的原因。\n")])])],-1),Dn=(0,t.Wm)("h3",{id:"v-if-与-v-for-为什么不建议一起使用",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#v-if-与-v-for-为什么不建议一起使用","aria-hidden":"true"},"#"),(0,t.Uk)(" v-if 与 v-for 为什么不建议一起使用")],-1),Pn=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"v-for 和 v-if 不要在同一个标签中使用,因为在vue2.0解析时先解析 v-for 优先级高于 v-if(vue3.0恰恰相反),这意味着 v-if 将分别重复运行于每个 v-for 循环中。如果遇到需要同时使用时可以考虑写成计算属性的方式。")],-1),En=(0,t.Wm)("h3",{id:"v-for-为什么要加-唯一的key",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#v-for-为什么要加-唯一的key","aria-hidden":"true"},"#"),(0,t.Uk)(" v-for 为什么要加 唯一的key")],-1),Tn=(0,t.Uk)("建议阅读有关"),An={href:"https://juejin.cn/post/6993478891243307022",target:"_blank",rel:"noopener noreferrer"},Ln=(0,t.Uk)("v-for"),qn=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"key 是为 Vue 中 vnode 的唯一标记，当diff oldCh 和 newCh 四种比较方式没有匹配到，如果设置了key就会用key和tag来判断是否sameNode"),(0,t.Wm)("li",null,"减少渲染次数，提升渲染性能，通过这个 key，我们的 diff 操作可以更准确、更快速。")]),(0,t.Wm)("p",null,"更准确：因为带 key 就不是原地复用了，在 sameNode 函数 a.key === b.key 对比中可以避免就地复用的情况。所以会更加准确。")],-1),Xn=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"createKeyToOldIdx"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("children"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" beginIdx"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" endIdx")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" i"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key\n  "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" map "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("i "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" beginIdx"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" i "),(0,t.Wm)("span",{class:"token operator"},"<="),(0,t.Uk)(" endIdx"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    key "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" children"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("key\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"isDef"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(" map"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" i\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" map\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])])],-1),Nn=(0,t.Wm)("h3",{id:"vue组件通信",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue组件通信","aria-hidden":"true"},"#"),(0,t.Uk)(" Vue组件通信")],-1),Fn=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"父子组件通信"),(0,t.Wm)("li",null,"兄弟组件通信"),(0,t.Wm)("li",null,"跨多层级组件通信"),(0,t.Wm)("li",null,"任意组件")],-1),Hn=(0,t.Wm)("h4",{id:"父子通信",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#父子通信","aria-hidden":"true"},"#"),(0,t.Uk)(" 父子通信")],-1),zn=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,[(0,t.Uk)("父组件通过 "),(0,t.Wm)("code",null,"props"),(0,t.Uk)(" 传递数据给子组件，子组件通过 "),(0,t.Wm)("code",null,"emit"),(0,t.Uk)(" 发送事件传递数据给父组件")]),(0,t.Wm)("li",null,[(0,t.Uk)("父组件"),(0,t.Wm)("code",null,"v-model"),(0,t.Uk)("(语法糖),子组件派发"),(0,t.Wm)("code",null,"this.$emit('input', 1)"),(0,t.Uk)("(原理在template解析里提过)")]),(0,t.Wm)("li",null,[(0,t.Uk)("通过访问 "),(0,t.Wm)("code",null,"$parent"),(0,t.Uk)(" 或者 "),(0,t.Wm)("code",null,"$children"),(0,t.Uk)(" 对象来访问组件实例中的方法和数据")]),(0,t.Wm)("li",null,[(0,t.Uk)("Vue 2.3 及以上版本的话还可以使用 "),(0,t.Wm)("code",null,"$listeners"),(0,t.Uk)("、"),(0,t.Wm)("code",null,"$attrs"),(0,t.Uk)(" 和 "),(0,t.Wm)("code",null,".sync"),(0,t.Uk)(" 属性")])])],-1),Rn=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"$attrs：当前组件的属性，通俗的讲也就是在组件标签定义的一系列属性，如input的value，placeholder等，但是不包括在当前组件里面定义的props属性"),(0,t.Wm)("li",null,"$listeners：当前组件监听的事件，通俗的讲也就是在使用组件的时候在标签中定义的事件，如@input，以及一些自定义事件"),(0,t.Wm)("li",null,[(0,t.Uk)("当前组件中使用"),(0,t.Wm)("code",null,'v-bind="$attrs"'),(0,t.Uk)("、"),(0,t.Wm)("code",null,'v-bind="$props"'),(0,t.Uk)(","),(0,t.Wm)("code",null,'v-on="$listeners"'),(0,t.Uk)("也就是把之前父组件那里给它的属性再全部传到它的子组件")]),(0,t.Wm)("li",null,"多级组件传多个值时，调用目标组件绑定$attrs，可直接获取根组件所传递参数，而不用每一级组件逐层传递。例如：组件二次封装，想保留之前属性方法，并且扩展新属性方法。")],-1),Kn=(0,t.Wm)("div",{class:"language-text ext-text"},[(0,t.Wm)("pre",{class:"language-text"},[(0,t.Wm)("code",null,'\x3c!--父组件中--\x3e\n<input :value.sync="value" />\n\x3c!--以上写法等同于--\x3e\n<input :value="value" @update:value="v => value = v"></comp>\n\x3c!--子组件中--\x3e\n<script>\n  this.$emit(\'update:value\', 1)\n<\/script>\n')])],-1),Yn=(0,t.Wm)("h4",{id:"兄弟组件通信",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#兄弟组件通信","aria-hidden":"true"},"#"),(0,t.Uk)(" 兄弟组件通信")],-1),Zn=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,[(0,t.Uk)("对于这种情况可以通过查找父组件中的子组件实现，也就是 "),(0,t.Wm)("code",null,"this.$parent.$children"),(0,t.Uk)("，在 "),(0,t.Wm)("code",null,"$children"),(0,t.Uk)(" 中可以通过组件 name 查询到需要的组件实例，然后进行通信。")])],-1),Gn=(0,t.Wm)("h4",{id:"跨多层次组件通信",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#跨多层次组件通信","aria-hidden":"true"},"#"),(0,t.Uk)(" 跨多层次组件通信")],-1),Bn=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"provide / inject，虽然文档中不推荐直接使用在业务中，但是如果用得好的话还是很有用的。 假设有父组件 A，然后有一个跨多层级的子组件 B,element表单中有使用(disabled)")],-1),Jn=(0,t.Wm)("div",{class:"language-text ext-text"},[(0,t.Wm)("pre",{class:"language-text"},[(0,t.Wm)("code",null,"// 父组件 A\nexport default {\n  provide: {\n    data: 1\n  }\n}\n// 子组件 B\nexport default {\n  inject: ['data'],\n  mounted() {\n    // 无论跨几层都能获得父组件的 data 属性\n    console.log(this.data) // => 1\n  }\n}\n")])],-1),Qn=(0,t.Wm)("h4",{id:"任意组件",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#任意组件","aria-hidden":"true"},"#"),(0,t.Uk)(" 任意组件")],-1),_n=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"这种方式可以通过 Vuex 或者 Event Bus（Vue本身就有EventBus能力，不需要再引入EventBus） 解决，另外如果你不怕麻烦的话，可以使用这种方式解决上述所有的通信情况"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"Vuex: UserInfo、getUserInfo、logout"),(0,t.Wm)("li",null,"Event Bus: $on不会自己销毁，需要我们手动给销毁，否则会重复触发,甚至造成内存泄漏，在keep-alive中尤为明显。")])],-1),$n=(0,t.Wm)("h3",{id:"组件生命周期",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#组件生命周期","aria-hidden":"true"},"#"),(0,t.Uk)(" 组件生命周期")],-1),ns=(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:i,alt:"VUE"})],-1),ss=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"beforeCreate 在实例初始化之后，数据观测(data observer) 和 event/watcher 事件配置之前被调用。在当前阶段 data、methods、computed 以及 watch 上的数据和方法都不能被访问"),(0,t.Wm)("li",null,"created 实例已经创建完成之后被调用。在这一步，实例已完成以下的配置：数据观测(data observer)，属性和方法的运算， watch/event 事件回调。这里没有$el,如果非要想与 Dom 进行交互，可以通过 vm.$nextTick 来访问 Dom"),(0,t.Wm)("li",null,"beforeMount 在挂载开始之前被调用：相关的 render 函数首次被调用。"),(0,t.Wm)("li",null,"mounted 在挂载完成后发生，在当前阶段，真实的 Dom 挂载完毕，数据完成双向绑定，可以访问到 Dom 节点"),(0,t.Wm)("li",null,"beforeUpdate 数据更新时调用，发生在虚拟 DOM 重新渲染和打补丁（patch）之前。可以在这个钩子中进一步地更改状态，这不会触发附加的重渲染过程"),(0,t.Wm)("li",null,"updated 发生在更新完成之后，当前阶段组件 Dom 已完成更新。要注意的是避免在此期间更改数据，因为这可能会导致无限循环的更新，该钩子在服务器端渲染期间不被调用。"),(0,t.Wm)("li",null,"beforeDestroy 实例销毁之前调用。在这一步，实例仍然完全可用。我们可以在这时进行善后收尾工作，比如清除计时器。"),(0,t.Wm)("li",null,"destroyed Vue 实例销毁后调用。调用后，Vue 实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁。 该钩子在服务器端渲染期间不被调用。"),(0,t.Wm)("li",null,"activated keep-alive 专属，组件被激活时调用"),(0,t.Wm)("li",null,"deactivated keep-alive 专属，组件被销毁时调用"),(0,t.Wm)("li",null,"errorCaptured(错误调用)：当捕获一个来自后代组件的错误时被调用")])],-1),as=(0,t.Wm)("h3",{id:"父子组件的渲染顺序",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#父子组件的渲染顺序","aria-hidden":"true"},"#"),(0,t.Uk)(" 父子组件的渲染顺序")],-1),ts=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"加载渲染过程 父beforeCreate->父created->父beforeMount->子beforeCreate->子created->子beforeMount->子mounted->父mounted"),(0,t.Wm)("li",null,"子组件更新过程 父beforeUpdate->子beforeUpdate->子updated->父updated 父组件更新过程 父beforeUpdate->父updated"),(0,t.Wm)("li",null,"销毁过程 父beforeDestroy->子beforeDestroy->子destroyed->父destroyed")])],-1),os=(0,t.Wm)("h3",{id:"keep-alive-使用场景和原理",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#keep-alive-使用场景和原理","aria-hidden":"true"},"#"),(0,t.Uk)(" keep-alive 使用场景和原理")],-1),es=(0,t.Uk)("建议阅读有关"),cs={href:"https://www.jianshu.com/p/9523bb439950",target:"_blank",rel:"noopener noreferrer"},ps=(0,t.Uk)("keep-alive源码"),ks=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"keep-alive 是 Vue 内置的一个组件，可以实现组件缓存，当组件切换时不会对当前组件进行卸载。"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"常用的两个属性 include/exclude/max，允许组件有条件的进行缓存。"),(0,t.Wm)("li",null,"两个生命周期 activated/deactivated，用来得知当前组件是否处于活跃状态。"),(0,t.Wm)("li",null,"keep-alive 的中还运用了 LRU(最近最少使用) 算法，选择最近最久未使用的组件予以淘汰。")]),(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,"在首次加载被包裹组建时，由keep-alive.js中的render函数可知，vnode.componentInstance的值是undfined，keepAlive的值是true，因为keep-alive组件作为父组件，它的render函数会先于被包裹组件执行；那么只执行到i(vnode,false)，后面的逻辑不执行；"),(0,t.Wm)("li",null,"再次访问被包裹组件时，vnode.componentInstance的值就是已经缓存的组件实例，那么会执行insert(parentElm, vnode.elm, refElm)逻辑，这样就直接把上一次的DOM插入到父元素中。")])],-1),ls=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token comment"},"// 大白话就是将render 返回的Vnode存储下来了，当命中的时候再取出来通过render返回"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"default"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  name"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"keep-alive"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  abstract"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"true"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//抽象组件"),(0,t.Uk)("\n\n  props"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    include"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" patternTypes"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//要缓存的组件"),(0,t.Uk)("\n    exclude"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" patternTypes"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//要排除的组件"),(0,t.Uk)("\n    max"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("String"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" Number"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//最大缓存数"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token function"},"created"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("cache "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" Object"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"create"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//缓存对象  {a:vNode,b:vNode}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("keys "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//缓存组件的key集合 [a,b]"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token function"},"destroyed"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" key "),(0,t.Wm)("span",{class:"token keyword"},"in"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("cache"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"pruneCacheEntry"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("cache"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("keys"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token function"},"mounted"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"//动态监听include  exclude"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"$watch"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"include"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"val"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"pruneCache"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"name"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"matches"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("val"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"$watch"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"exclude"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"val"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"pruneCache"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"name"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token function"},"matches"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("val"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token function"},"render"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" slot "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("$slots"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("default"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//获取包裹的插槽默认值"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" VNode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"getFirstComponentChild"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("slot"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//获取第一个子组件"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" componentOptions"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)("VNodeComponentOptions "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)("\n      vnode "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("componentOptions"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("componentOptions"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// check pattern"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)("string "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"getComponentName"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("componentOptions"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" include"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" exclude "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 不走缓存"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// not included  不包含"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("include "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Uk)("name "),(0,t.Wm)("span",{class:"token operator"},"||"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Wm)("span",{class:"token function"},"matches"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("include"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"||"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// excluded  排除里面"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("exclude "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(" name "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"matches"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("exclude"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" name"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"//返回虚拟节点"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" cache"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" keys "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)("string "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)("\n        vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("key "),(0,t.Wm)("span",{class:"token operator"},"=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// same constructor may get registered as different local components"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token comment"},"// so cid alone is not enough (#3269)"),(0,t.Uk)("\n            componentOptions"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("Ctor"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("cid "),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)("\n            "),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("componentOptions"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("tag "),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token template-string"},[(0,t.Wm)("span",{class:"token template-punctuation string"},"`"),(0,t.Wm)("span",{class:"token string"},"::"),(0,t.Wm)("span",{class:"token interpolation"},[(0,t.Wm)("span",{class:"token interpolation-punctuation punctuation"},"${"),(0,t.Uk)("componentOptions"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("tag"),(0,t.Wm)("span",{class:"token interpolation-punctuation punctuation"},"}")]),(0,t.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'""'),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("cache"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"//通过key 找到缓存 获取实例"),(0,t.Uk)("\n        vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("componentInstance "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" cache"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("componentInstance"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// make current key freshest"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token function"},"remove"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("keys"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//通过LRU算法把数组里面的key删掉"),(0,t.Uk)("\n        keys"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"push"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//把它放在数组末尾"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        cache"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" vnode"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//没找到就换存下来"),(0,t.Uk)("\n        keys"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"push"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//把它放在数组末尾"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// prune oldest entry  //如果超过最大值就把数组第0项删掉"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("max "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(" keys"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length "),(0,t.Wm)("span",{class:"token operator"},">"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"parseInt"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("max"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token function"},"pruneCacheEntry"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("cache"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" keys"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" keys"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("_vnode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n      vnode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("data"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("keepAlive "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"true"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//标记虚拟节点已经被缓存"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 返回虚拟节点"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" vnode "),(0,t.Wm)("span",{class:"token operator"},"||"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("slot "),(0,t.Wm)("span",{class:"token operator"},"&&"),(0,t.Uk)(" slot"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])])],-1),us=(0,t.Wm)("h3",{id:"nexttick-原理和使用场景",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#nexttick-原理和使用场景","aria-hidden":"true"},"#"),(0,t.Uk)(" $nextTick 原理和使用场景")],-1),ms=(0,t.Uk)("建议阅读有关"),Ws={href:"https://juejin.cn/post/6939704519668432910#heading-4",target:"_blank",rel:"noopener noreferrer"},is=(0,t.Uk)("nextTick源码"),rs=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,"Vue 组件是异步渲染,$nextTick 会在DOM渲染之后被触发回调，以获取最新的DOM节点。"),(0,t.Wm)("li",null,"页面渲染时会将data的修改做整合，多次data的修改会合并成一次DOM渲染，否则渲染过于频繁太耗性能了。")]),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("$nextTick内部实现了microtask队列 2.5 之前会使用"),(0,t.Wm)("code",null,"Mutation.Observe"),(0,t.Uk)(", 2.5之后是用优雅降级"),(0,t.Wm)("code",null,"setImmediate"),(0,t.Uk)("-"),(0,t.Wm)("code",null,"MessageChannel"),(0,t.Uk)("-"),(0,t.Wm)("code",null,"Promise"),(0,t.Uk)("-"),(0,t.Wm)("code",null,"setTimeout")])])],-1),Us=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" callbacks "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" pending "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"false"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"flushCallbacks"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  pending "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"false"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//把标志还原为false"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 依次执行回调"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" i "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" i "),(0,t.Wm)("span",{class:"token operator"},"<"),(0,t.Uk)(" callbacks"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("length"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(" i"),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    callbacks"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("i"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" timerFunc"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//定义异步方法  采用优雅降级"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"typeof"),(0,t.Uk)(" Promise "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"undefined"'),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 如果支持promise"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" p "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" Promise"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"resolve"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function-variable function"},"timerFunc"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    p"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"then"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("flushCallbacks"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"typeof"),(0,t.Uk)(" MutationObserver "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"undefined"'),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// MutationObserver 主要是监听dom变化 也是一个异步方法"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" counter "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" observer "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"MutationObserver"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("flushCallbacks"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" textNode "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" document"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"createTextNode"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token function"},"String"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("counter"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  observer"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"observe"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("textNode"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    characterData"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"true"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function-variable function"},"timerFunc"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    counter "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("counter "),(0,t.Wm)("span",{class:"token operator"},"+"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"1"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"%"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"2"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    textNode"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("data "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"String"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("counter"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"typeof"),(0,t.Uk)(" setImmediate "),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},'"undefined"'),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 如果前面都不支持 判断setImmediate"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function-variable function"},"timerFunc"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"setImmediate"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("flushCallbacks"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 最后降级采用setTimeout"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token function-variable function"},"timerFunc"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"setTimeout"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("flushCallbacks"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"nextTick"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"cb"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 除了渲染watcher  还有用户自己手动调用的nextTick 一起被收集到数组"),(0,t.Uk)("\n  callbacks"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"push"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("cb"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Uk)("pending"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 如果多次调用nextTick  只会执行一次异步 等异步队列清空之后再把标志变为false"),(0,t.Uk)("\n    pending "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"true"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"timerFunc"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])])],-1),ds=(0,t.Wm)("h3",{id:"vue-mixin-的使用场景和原理",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue-mixin-的使用场景和原理","aria-hidden":"true"},"#"),(0,t.Uk)(" Vue.mixin 的使用场景和原理")],-1),vs=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"在日常的开发中，我们经常会遇到在不同的组件中经常会需要用到一些相同或者相似的代码，这些代码的功能相对独立，可以通过 Vue 的 mixin 功能抽离公共的业务逻辑，原理类似“对象的继承”，当组件初始化时会调用 mergeOptions 方法进行合并，采用策略模式针对不同的属性进行合并。当组件和混入对象含有同名选项时，这些选项将以恰当的方式进行“合并”。"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"缺点：(Vue3推出 Compostion Api 去解决这些问题)")]),(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,"变量来源不明确，不利于阅读（只能靠全局搜索）"),(0,t.Wm)("li",null,"多mixin可能会造成命名冲突"),(0,t.Wm)("li",null,"mixin和组件可能出现多对多的关系，复杂度较高")])],-1),hs=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"default"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"initMixin"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"Vue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  Vue"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function-variable function"},"mixin"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"mixin"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"//   合并对象"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("options"),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Wm)("span",{class:"token function"},"mergeOptions"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("options"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("mixin"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token comment"},"// src/util/index.js"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 定义生命周期"),(0,t.Uk)("\ncreated\nbeforecreated\nmounted\nupated\ndestroy\n"),(0,t.Wm)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token constant"},"LIFECYCLE_HOOKS"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token string"},'"beforeCreate"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token string"},'"created"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token string"},'"beforeMount"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token string"},'"mounted"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token string"},'"beforeUpdate"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token string"},'"updated"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token string"},'"beforeDestroy"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token string"},'"destroyed"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token comment"},"// 合并策略"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" strats "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// mixin核心方法"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"mergeOptions"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("parent"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" child")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" options "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 遍历父亲"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" k "),(0,t.Wm)("span",{class:"token keyword"},"in"),(0,t.Uk)(" parent"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"mergeFiled"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("k"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 父亲没有 儿子有"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"for"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" k "),(0,t.Wm)("span",{class:"token keyword"},"in"),(0,t.Uk)(" child"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token operator"},"!"),(0,t.Uk)("parent"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"hasOwnProperty"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("k"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"mergeFiled"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("k"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n\n  "),(0,t.Wm)("span",{class:"token comment"},"//真正合并字段方法"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"mergeFiled"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"k"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("strats"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("k"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      options"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("k"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" strats"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("k"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("parent"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("k"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" child"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("k"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 默认策略"),(0,t.Uk)("\n      options"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("k"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" child"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("k"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"?"),(0,t.Uk)(" child"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("k"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" parent"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("k"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" options"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])])],-1),ys=(0,t.Wm)("h3",{id:"vue-extend-作用和原理",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue-extend-作用和原理","aria-hidden":"true"},"#"),(0,t.Uk)(" Vue.extend 作用和原理")],-1),fs=(0,t.Uk)("建议阅读有关"),ws={href:"https://juejin.cn/post/6954173708344770591",target:"_blank",rel:"noopener noreferrer"},gs=(0,t.Uk)("组件原理"),bs=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"官方解释：Vue.extend 使用基础 Vue 构造器，创建一个“子类”,参数是一个包含组件选项的对象。 其实就是一个子类构造器 是 Vue 组件的核心 api 实现思路就是使用原型继承的方法返回了 Vue 的子类 并且利用mergeOptions 把传入组件的 options 和父类的 options 进行了合并,最终还是要通过Vue.components注册才可以使用。(例如实现一个全局提示组件)")],-1),xs=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"default"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"initExtend"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"Vue"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"let"),(0,t.Uk)(" cid "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"0"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//组件的唯一标识"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 创建子类继承Vue父类 便于属性扩展"),(0,t.Uk)("\n  Vue"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function-variable function"},"extend"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"extendOptions"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 创建子类的构造函数 并且调用初始化方法"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function-variable function"},"Sub"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"VueComponent"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"options"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"_init"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("options"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//调用Vue初始化方法"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    Sub"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("cid "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" cid"),(0,t.Wm)("span",{class:"token operator"},"++"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token class-name"},"Sub"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("prototype "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" Object"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"create"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("prototype"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 子类原型指向父类"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token class-name"},"Sub"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("prototype"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("constructor "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" Sub"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//constructor指向自己"),(0,t.Uk)("\n    Sub"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("options "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"mergeOptions"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("options"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" extendOptions"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//合并自己的options和父类的options"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" Sub"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])])],-1),Vs=(0,t.Wm)("h3",{id:"vue自定义指令作用和原理",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue自定义指令作用和原理","aria-hidden":"true"},"#"),(0,t.Uk)(" Vue自定义指令作用和原理")],-1),js=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"指令本质上是装饰器，是 vue 对 HTML 元素的扩展，给 HTML 元素增加自定义功能。vue 编译 DOM 时，会找到指令对象，执行指令的相关方法。(例如:v-html、v-transfer-dom实现dom挂载指定节点、v-copy实现复制、实现按钮权限控制或者点击特效) 自定义指令有五个生命周期"),(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,[(0,t.Wm)("code",null,"bind"),(0,t.Uk)("：只调用一次，指令第一次绑定到元素时调用。在这里可以进行一次性的初始化设置。")]),(0,t.Wm)("li",null,[(0,t.Wm)("code",null,"inserted"),(0,t.Uk)("：被绑定元素插入父节点时调用 (仅保证父节点存在，但不一定已被插入文档中)。")]),(0,t.Wm)("li",null,[(0,t.Wm)("code",null,"update"),(0,t.Uk)("：被绑定于元素所在的模板更新时调用，而无论绑定值是否变化。通过比较更新前后的绑定值，可以忽略不必要的模板更新。")]),(0,t.Wm)("li",null,[(0,t.Wm)("code",null,"componentUpdated"),(0,t.Uk)("：被绑定元素所在模板完成一次更新周期时调用。")]),(0,t.Wm)("li",null,[(0,t.Wm)("code",null,"unbind"),(0,t.Uk)("：只调用一次，指令与元素解绑时调用。")])])],-1),Cs=(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,"原理")],-1),Os=(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,"在生成 ast 语法树时，遇到指令会给当前元素添加 directives 属性"),(0,t.Wm)("li",null,"通过 genDirectives 生成指令代码"),(0,t.Wm)("li",null,"在 patch 前将指令的钩子提取到 cbs 中,在 patch 过程中调用对应的钩子"),(0,t.Wm)("li",null,"当执行指令对应钩子函数时，调用对应指令定义的方法")],-1),Ms=(0,t.Wm)("h3",{id:"vuex",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vuex","aria-hidden":"true"},"#"),(0,t.Uk)(" VUEX")],-1),Is=(0,t.Wm)("p",null,[(0,t.Wm)("img",{src:"data:image/png;base64,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",alt:"VUE"})],-1),Ss=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,"vuex 是专门为 vue 提供的全局状态管理系统，用于多个组件中数据共享、数据缓存等。（无法持久化、内部核心原理是通过创造一个全局实例 new Vue） State：定义了应用状态的数据结构，可以在这里设置默认的初始状态。 Getter：允许组件从 Store 中获取数据，mapGetters 辅助函数仅仅是将 store 中的 getter 映射到局部计算属性。 Mutation：是唯一更改 store 中状态的方法，他是一个原子操作，原子最小，且必须是同步函数。 Action：用于提交 mutation，而不是直接变更状态，可以包含任意异步或者整合多个Mutation操作。 Module：允许将单一的 Store 拆分为多个 store 且同时保存在单一的状态树中。")],-1),Ds=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"export"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"default"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},[(0,t.Uk)("Vuex"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("Store")]),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  state"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    userInfo"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  mutations"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token constant"},"SET_USER_INFO"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("state"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" userInfo")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      state"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("userInfo "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" userInfo\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  actions"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"getInfo"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)(" commit"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" state "),(0,t.Wm)("span",{class:"token punctuation"},"}")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Promise"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("resolve"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" reject")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token function"},"getInfo"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"then"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"async"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token parameter"},"response"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token function"},"commit"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'SET_USER_INFO'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" response"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token function"},"resolve"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("response"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"catch"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},"error"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token function"},"reject"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("error"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  modules"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("$store"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"commit"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'SET_USER_INFO'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 同步"),(0,t.Uk)("\nstore"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"dispatch"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'getInfo'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"then"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 异步"),(0,t.Uk)("\n")])])],-1),Ps=(0,t.Wm)("h3",{id:"vue-router-路由模式有几种",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue-router-路由模式有几种","aria-hidden":"true"},"#"),(0,t.Uk)(" vue-router 路由模式有几种？")],-1),Es=(0,t.Wm)("p",null,[(0,t.Uk)("vue-router 有 3 种路由模式："),(0,t.Wm)("code",null,"hash"),(0,t.Uk)("、"),(0,t.Wm)("code",null,"history"),(0,t.Uk)("、"),(0,t.Wm)("code",null,"abstract"),(0,t.Uk)("，对应的源码如下所示：")],-1),Ts=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token keyword"},"switch"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("mode"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"case"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'history'"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("history "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"HTML5History"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" options"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("base"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"break"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"case"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'hash'"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("history "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"HashHistory"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" options"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("base"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("fallback"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"break"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 适用于所有JavaScript环境，例如服务器端和Node.js. 如果没有浏览器API，路由器将自动强制进入此模式。"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"case"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'abstract'"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(" \n    "),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("history "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"AbstractHistory"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"this"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" options"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("base"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"break"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"default"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("process"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("env"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token constant"},"NODE_ENV"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"!=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'production'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token function"},"assert"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token boolean"},"false"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token template-string"},[(0,t.Wm)("span",{class:"token template-punctuation string"},"`"),(0,t.Wm)("span",{class:"token string"},"invalid mode: "),(0,t.Wm)("span",{class:"token interpolation"},[(0,t.Wm)("span",{class:"token interpolation-punctuation punctuation"},"${"),(0,t.Uk)("mode"),(0,t.Wm)("span",{class:"token interpolation-punctuation punctuation"},"}")]),(0,t.Wm)("span",{class:"token template-punctuation string"},"`")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])])],-1),As=(0,t.Wm)("h4",{id:"hash-模式",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#hash-模式","aria-hidden":"true"},"#"),(0,t.Uk)(" hash 模式")],-1),Ls=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,[(0,t.Uk)("1.就是指 url 尾巴后的 # 号以及后面的字符, 请求的时候不会被包含在 "),(0,t.Wm)("code",null,"http"),(0,t.Uk)(" 请求中 只会携带#之前的，所以每次改变hash不会重新请求加载页面 2.hash 改变会触发 hashchange 事件,能兼容到ie8。 3.hash变化会被浏览器记录，浏览器的"),(0,t.Wm)("code",null,"前进"),(0,t.Uk)("和"),(0,t.Wm)("code",null,"后退"),(0,t.Uk)("都能用。")])],-1),qs=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Uk)("window"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addEventListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"hashchange"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" funcRef"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"false"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// history.transition() -> history.confirmTransition() ->history.update(route)->app._route=route"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// app._route=route此时会触发vue组件的re-render,通过router-view函数式组件render出匹配的组件"),(0,t.Uk)("\n")])])],-1),Xs=(0,t.Wm)("h4",{id:"history-模式",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#history-模式","aria-hidden":"true"},"#"),(0,t.Uk)(" history 模式")],-1),Ns=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("p",null,[(0,t.Uk)("利用了 HTML5 History Interface 中新增的 pushState() 和 replaceState() 方法。这两个 API 可以在不进行刷新的情况下，操作浏览器的历史纪录。唯一不同的是，前者是新增一个历史记录，后者是直接替换当前的历史记录,"),(0,t.Wm)("code",null,"history"),(0,t.Uk)("只能兼容到 "),(0,t.Wm)("code",null,"IE10"),(0,t.Uk)(",需要额外的Nginx配置，否则刷新后会404")])],-1),Fs=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Uk)("window"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("history"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"pushState"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("state"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" title"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" url"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\nwindow"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("history"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"replaceState"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("state"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" title"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" url"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\nwindow"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"addEventListener"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},'"popstate"'),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token operator"},"=>"),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\nwindow"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("history"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"back"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 后退"),(0,t.Uk)("\nwindow"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("history"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"forward"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 前进"),(0,t.Uk)("\nwindow"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("history"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"go"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token operator"},"-"),(0,t.Wm)("span",{class:"token number"},"3"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("  "),(0,t.Wm)("span",{class:"token comment"},"// 后退三个页面"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// Nginx配置 无论写任何path都会返回index.html，"),(0,t.Uk)("\nlocation "),(0,t.Wm)("span",{class:"token operator"},"/"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  try_files $uri $uri"),(0,t.Wm)("span",{class:"token operator"},"/"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"/"),(0,t.Uk)("index"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("html"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  root "),(0,t.Wm)("span",{class:"token operator"},"/"),(0,t.Uk)("data"),(0,t.Wm)("span",{class:"token operator"},"/"),(0,t.Uk)("files"),(0,t.Wm)("span",{class:"token operator"},"/"),(0,t.Uk)("dist"),(0,t.Wm)("span",{class:"token operator"},"/"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  index index"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Uk)("html"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n  add_header Access"),(0,t.Wm)("span",{class:"token operator"},"-"),(0,t.Uk)("Control"),(0,t.Wm)("span",{class:"token operator"},"-"),(0,t.Uk)("Allow"),(0,t.Wm)("span",{class:"token operator"},"-"),(0,t.Uk)("Origin "),(0,t.Wm)("span",{class:"token operator"},"*"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])])],-1),Hs=(0,t.Wm)("h3",{id:"proxy-和-reflect-作用和使用",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#proxy-和-reflect-作用和使用","aria-hidden":"true"},"#"),(0,t.Uk)(" Proxy 和 Reflect 作用和使用")],-1),zs=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token comment"},"/*\n  Proxy.set陷阱默认接收 四个参数\n  trapTarget 用于接收属性（代理的目标）的对象\n  key 要写入的属性键（字符串或Symbol类型）\n  value 被写入的属性的值\n  receiver 操作发生的对象（通常是代理）\n*/"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// Reflect作用"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 1. 和Proxy能力一一对应"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 2. 规范化、标准化、函数式"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 3. 替代掉Object上的工具函数（让object更纯净）"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// const obj = {a: '100'};"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// 'a' in obj ==> Reflect.has(obj, 'a') // 函数式"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// delete obj.a ==> Reflect.deleteProperty(obj, 'a')"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// Object.getOwnPropertyNames(obj) ===> Reflect.ownKeys(obj)"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" data2 "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  name"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'李狗蛋'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  age"),(0,t.Wm)("span",{class:"token operator"},":"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token number"},"24"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" array "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Wm)("span",{class:"token string"},"'a'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token string"},"'b'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Wm)("span",{class:"token string"},"'c'"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// Proxy 和 Reflect 配合使用，Proxy代理 Reflect 做反射，反射到目标属性的的属性值"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" proxyData "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Proxy"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("array"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" receiver"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" result "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" Reflect"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" receiver"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 只处理本身(非原型的)属性"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" ownKeys "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" Reflect"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"ownKeys"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("ownKeys"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"includes"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'__get:'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" result"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//监听"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" result "),(0,t.Wm)("span",{class:"token comment"},"//返回结果"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"set"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" value"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" receiver"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// 重复数据不处理"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("value "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(" target"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n          "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"true"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token comment"},"// Reflect.set 方法 返回Boolean 是否设置成功(有些数据是不能被修改的，所以返回是否修改成功)"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" result "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" Reflect"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"set"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" value"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" receiver"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'__set:'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" value"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" result"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//set age 30"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" result "),(0,t.Wm)("span",{class:"token comment"},"// 返回Boolean 是否设置成功"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"deleteProperty"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" result "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" Reflect"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"deleteProperty"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n        console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'__delete property:'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//delete property name"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" result "),(0,t.Wm)("span",{class:"token comment"},"//返回Boolean 是否删除成功"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// data2.age // 不会打印，需要用代理之后的proxyData"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// proxyData.age "),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// proxyData.age = 27"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// delete proxyData.age"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token comment"},"// proxyData.push // push ƒ push() { [native code] }"),(0,t.Uk)("\nproxyData"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"push"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'d'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},";"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token comment"},"/*\n  // 用Reflect.ownKey过滤，否则会打印push方法\n  __get: push ƒ push() { [native code] }\n  __get: length 3\n  __set: 3 d true\n  __set: length 4 true \n*/"),(0,t.Uk)("\n")])])],-1),Rs=(0,t.Wm)("h3",{id:"vue3-0-proxy实现响应式原理",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue3-0-proxy实现响应式原理","aria-hidden":"true"},"#"),(0,t.Uk)(" Vue3.0 Proxy实现响应式原理")],-1),Ks=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,"创建响应式方法reactive(data)，该方法可以传入需要处理的数据对象data 函数内逻辑："),(0,t.Wm)("li",null,"判断 data 是否为 对象或者数组，不是直接返回"),(0,t.Wm)("li",null,"创建 Proxy 代理对象，Proxy对象中传入data Proxy 代理对象中的方法配置："),(0,t.Wm)("li",null,"在get()方法对数据的进行监听：只监听 处理本身（非原型）的属性；在返回结果中采用递归调用reactive(),实现对数据的深度监听"),(0,t.Wm)("li",null,"在 set() 方法中进行数据的新增和更新：判断是否是新增数据；重复的数据不处理；"),(0,t.Wm)("li",null,"在 deleteProperty() 方法中对数据进行删除操作； 实例："),(0,t.Wm)("li",null,"定义数据data,传入响应式方法中，返回的值proxyData为实现响应式的可操作数据")])],-1),Ys=(0,t.Wm)("div",{class:"language-javascript ext-js"},[(0,t.Wm)("pre",{class:"language-javascript"},[(0,t.Wm)("code",null,[(0,t.Wm)("span",{class:"token comment"},"// 创建响应式"),(0,t.Uk)("\n"),(0,t.Wm)("span",{class:"token keyword"},"function"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"reactive"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("target "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Wm)("span",{class:"token punctuation"},"}")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token keyword"},"typeof"),(0,t.Uk)(" target "),(0,t.Wm)("span",{class:"token operator"},"!="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token string"},"'object'"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token operator"},"||"),(0,t.Uk)(" target "),(0,t.Wm)("span",{class:"token operator"},"=="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"null"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// 不是对象或者数组，则返回"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" target\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token comment"},"// 代理配置 生成代理对象"),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" observed "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"new"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token class-name"},"Proxy"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// target：目标对象、 key：被捕获的属性名、receiver：Proxy或者继承Proxy的对象"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" receiver"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 只监听 处理本身（非原型）的属性 ,如push()"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" ownKeys "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" Reflect"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"ownKeys"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("ownKeys"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"includes"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'get'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//监听"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" result "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" Reflect"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"get"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" receiver"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// return result //返回结果"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 深度监听"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 性能如何提升的？"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token function"},"reactive"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("result"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"// 可能是对象 递归get处理 实现深度监听"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token comment"},"// value 新属性值。"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"set"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" value"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" receiver"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 判断是否是新增属性"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" ownKeys "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" Reflect"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"ownKeys"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("ownKeys"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"includes"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'已有的 key'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//监听"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token keyword"},"else"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'新增的 key'"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token comment"},"// 重复的数据不处理"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" oldVal "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" target"),(0,t.Wm)("span",{class:"token punctuation"},"["),(0,t.Uk)("key"),(0,t.Wm)("span",{class:"token punctuation"},"]"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"if"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("value "),(0,t.Wm)("span",{class:"token operator"},"==="),(0,t.Uk)(" oldVal"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n        "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token boolean"},"true"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" result "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" Reflect"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"set"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" value"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" receiver"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'set'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" value"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//set age 30"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" result "),(0,t.Wm)("span",{class:"token comment"},"//是否设置成功"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token function"},"deleteProperty"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token parameter"},[(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key")]),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token punctuation"},"{"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"const"),(0,t.Uk)(" result "),(0,t.Wm)("span",{class:"token operator"},"="),(0,t.Uk)(" Reflect"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"deleteProperty"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Uk)("target"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n      console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'delete property'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" key"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//delete property name"),(0,t.Uk)("\n      console"),(0,t.Wm)("span",{class:"token punctuation"},"."),(0,t.Wm)("span",{class:"token function"},"log"),(0,t.Wm)("span",{class:"token punctuation"},"("),(0,t.Wm)("span",{class:"token string"},"'result'"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)(" result"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)(),(0,t.Wm)("span",{class:"token comment"},"//result true"),(0,t.Uk)("\n      "),(0,t.Wm)("span",{class:"token keyword"},"return"),(0,t.Uk)(" result "),(0,t.Wm)("span",{class:"token comment"},"//是否删除成功"),(0,t.Uk)("\n    "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},","),(0,t.Uk)("\n  "),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Wm)("span",{class:"token punctuation"},")"),(0,t.Uk)("\n\n"),(0,t.Wm)("span",{class:"token punctuation"},"}"),(0,t.Uk)("\n")])])],-1),Zs=(0,t.Wm)("h3",{id:"vue3-0-proxy-和-defineproperty-对比",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue3-0-proxy-和-defineproperty-对比","aria-hidden":"true"},"#"),(0,t.Uk)(" Vue3.0 "),(0,t.Wm)("code",null,"Proxy"),(0,t.Uk)(" 和 "),(0,t.Wm)("code",null,"defineProperty"),(0,t.Uk)(" 对比")],-1),Gs=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("ul",null,[(0,t.Wm)("li",null,[(0,t.Uk)("深度监听，性能更好("),(0,t.Wm)("code",null,"Proxy.get"),(0,t.Uk)(" 访问到才进行监听, 而使用"),(0,t.Wm)("code",null,"defineProperty"),(0,t.Uk)("直接递归到底计算量大)")]),(0,t.Wm)("li",null,"可监听新增/删除 属性"),(0,t.Wm)("li",null,"可监听数组变化"),(0,t.Wm)("li",null,[(0,t.Uk)("Proxy能规避"),(0,t.Wm)("code",null,"Object.defineProperty"),(0,t.Uk)("的问题")]),(0,t.Wm)("li",null,"Proxy无法兼容所有浏览器，无法polyfill")])],-1),Bs=(0,t.Wm)("h3",{id:"vue3-0",tabindex:"-1"},[(0,t.Wm)("a",{class:"header-anchor",href:"#vue3-0","aria-hidden":"true"},"#"),(0,t.Uk)(" Vue3.0")],-1),Js=(0,t.Wm)("div",{class:"custom-container tip"},[(0,t.Wm)("p",{class:"custom-container-title"},"TIP"),(0,t.Wm)("ol",null,[(0,t.Wm)("li",null,"Vue3.0更好的代码管理方式：monorepo"),(0,t.Wm)("li",null,[(0,t.Uk)("Vue3.2新增"),(0,t.Wm)("code",null,"v-memo"),(0,t.Uk)(",渲染 "),(0,t.Wm)("code",null,"v-for"),(0,t.Uk)(" 长列表 (长度大于 1000）可以加上"),(0,t.Wm)("code",null,"v-memo"),(0,t.Uk)("配合使用,它提供了记忆模板树的一部分的能力。命中允许 Vue 不仅跳过虚拟 DOM 差异，而且完全跳过新 VNode 的创建,复用 Vnode,空间换时间优化。")])])],-1),Qs={render:function(n,s){const a=(0,t.up)("OutboundLink");return(0,t.wg)(),(0,t.j4)(t.HY,null,[r,U,(0,t.Wm)("p",null,[d,(0,t.Wm)("a",v,[h,(0,t.Wm)(a)])]),y,f,w,g,b,x,V,j,C,O,M,I,S,D,P,E,T,A,L,q,X,N,F,H,z,R,K,Y,Z,G,B,J,Q,_,$,nn,sn,an,tn,on,en,cn,pn,kn,ln,un,mn,Wn,rn,Un,dn,vn,hn,yn,fn,wn,gn,bn,xn,Vn,jn,Cn,On,Mn,In,Sn,Dn,Pn,En,(0,t.Wm)("p",null,[Tn,(0,t.Wm)("a",An,[Ln,(0,t.Wm)(a)])]),qn,Xn,Nn,Fn,Hn,zn,Rn,Kn,Yn,Zn,Gn,Bn,Jn,Qn,_n,$n,ns,ss,as,ts,os,(0,t.Wm)("p",null,[es,(0,t.Wm)("a",cs,[ps,(0,t.Wm)(a)])]),ks,ls,us,(0,t.Wm)("p",null,[ms,(0,t.Wm)("a",Ws,[is,(0,t.Wm)(a)])]),rs,Us,ds,vs,hs,ys,(0,t.Wm)("p",null,[fs,(0,t.Wm)("a",ws,[gs,(0,t.Wm)(a)])]),bs,xs,Vs,js,Cs,Os,Ms,Is,Ss,Ds,Ps,Es,Ts,As,Ls,qs,Xs,Ns,Fs,Hs,zs,Rs,Ks,Ys,Zs,Gs,Bs,Js],64)}}}}]);