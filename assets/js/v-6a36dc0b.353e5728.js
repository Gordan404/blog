(self.webpackChunkvuepress_starter=self.webpackChunkvuepress_starter||[]).push([[797],{2878:(n,e,s)=>{"use strict";s.r(e),s.d(e,{data:()=>a});const a={key:"v-6a36dc0b",path:"/vueAnalysis/design/",title:"设计",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"源码目录设计",slug:"源码目录设计",children:[]},{level:2,title:"架构设计",slug:"架构设计",children:[]}],filePathRelative:"vueAnalysis/design/README.md",git:{updatedTime:1626959386e3,contributors:[{name:"jun6.li",email:"jun6.li@ly.com",commits:1}]}}},6448:(n,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>V});var a=s(4057);const l=s.p+"assets/img/composition.b6fbb9ae.png",o=(0,a.Wm)("h1",{id:"设计",tabindex:"-1"},[(0,a.Wm)("a",{class:"header-anchor",href:"#设计","aria-hidden":"true"},"#"),(0,a.Uk)(" 设计")],-1),t=(0,a.Wm)("h2",{id:"源码目录设计",tabindex:"-1"},[(0,a.Wm)("a",{class:"header-anchor",href:"#源码目录设计","aria-hidden":"true"},"#"),(0,a.Uk)(" 源码目录设计")],-1),m=(0,a.Wm)("p",null,[(0,a.Wm)("code",null,"Vue.js"),(0,a.Uk)("源码目录设计如下：")],-1),c=(0,a.Wm)("div",{class:"language-bash ext-sh"},[(0,a.Wm)("pre",{class:"language-bash"},[(0,a.Wm)("code",null,[(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- dist              "),(0,a.Wm)("span",{class:"token comment"},"# 构建目录"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- flow              "),(0,a.Wm)("span",{class:"token comment"},"# flow的类型声明，类似于TypeScipt"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- packages          "),(0,a.Wm)("span",{class:"token comment"},"# 衍生的npm包，例如vue-server-renderer和vue-template-compiler"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- scripts           "),(0,a.Wm)("span",{class:"token comment"},"# 构建配置和构建脚本"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- "),(0,a.Wm)("span",{class:"token builtin class-name"},"test"),(0,a.Uk)("              "),(0,a.Wm)("span",{class:"token comment"},"# 端到端测试和单元测试用例"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- src               "),(0,a.Wm)("span",{class:"token comment"},"# 源代码"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("   "),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- compiler      "),(0,a.Wm)("span",{class:"token comment"},"# 编译相关代码"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("   "),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- core          "),(0,a.Wm)("span",{class:"token comment"},"# 核心代码"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("   "),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- platforms     "),(0,a.Wm)("span",{class:"token comment"},"# 跨平台"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("   "),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- server        "),(0,a.Wm)("span",{class:"token comment"},"# 服务端渲染"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("   "),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- sfc           "),(0,a.Wm)("span",{class:"token comment"},"# .vue文件解析逻辑"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("   "),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- shared        "),(0,a.Wm)("span",{class:"token comment"},"# 工具函数/共享代码"),(0,a.Uk)("\n")])])],-1),k=(0,a.Wm)("p",null,"对以上目录简要做如下介绍：",-1),p=(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Wm)("code",null,"dist"),(0,a.Uk)("："),(0,a.Wm)("code",null,"rollup"),(0,a.Uk)("构建目录，里面存放了所有"),(0,a.Wm)("code",null,"Vue"),(0,a.Uk)("构建后不同版本的文件。")])]),(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Wm)("code",null,"flow"),(0,a.Uk)("：它是Facebook出品的"),(0,a.Wm)("code",null,"JavaScript"),(0,a.Uk)("静态类型检查工具，早期"),(0,a.Wm)("code",null,"Vue.js"),(0,a.Uk)("选择了"),(0,a.Wm)("code",null,"flow"),(0,a.Uk)("而不是现在的"),(0,a.Wm)("code",null,"TypeScript"),(0,a.Uk)("来做静态类型检查，而在最新的"),(0,a.Wm)("code",null,"Vue3.0"),(0,a.Uk)("版本则选择使用"),(0,a.Wm)("code",null,"TypeScript"),(0,a.Uk)("来重写。")])]),(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Wm)("code",null,"packages"),(0,a.Uk)("："),(0,a.Wm)("code",null,"Vue.js"),(0,a.Uk)("衍生的其它"),(0,a.Wm)("code",null,"npm"),(0,a.Uk)("包，它们在"),(0,a.Wm)("code",null,"Vue"),(0,a.Uk)("构建时自动从源码中生成并且始终和"),(0,a.Wm)("code",null,"Vue.js"),(0,a.Uk)("保持相同的版本，主要是"),(0,a.Wm)("code",null,"vue-server-renderer"),(0,a.Uk)("和"),(0,a.Wm)("code",null,"vue-template-compiler"),(0,a.Uk)("这两个包，其中最后一个包在我们使用脚手架生成项目，也就是使用"),(0,a.Wm)("code",null,".vue"),(0,a.Uk)("文件开发"),(0,a.Wm)("code",null,"Vue"),(0,a.Uk)("项目时会使用到这个包("),(0,a.Wm)("code",null,"vue-loader"),(0,a.Uk)(")。")])]),(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Wm)("code",null,"scripts"),(0,a.Uk)("："),(0,a.Wm)("code",null,"rollup"),(0,a.Uk)("构建配置和构建脚本，"),(0,a.Wm)("code",null,"Vue.js"),(0,a.Uk)("能够通过不同的环境构建不同的版本的秘密都在这个目录下。")])]),(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Wm)("code",null,"test"),(0,a.Uk)("："),(0,a.Wm)("code",null,"Vue.js"),(0,a.Uk)("测试目录，自动化测试对于一个开源库来说是至关重要的，测试覆盖率在一定程度上是衡量一个库质量的一个重要指标。测试用例无论对于开发还是阅读源码，都是有很大益处的，其中通过测试用例去阅读"),(0,a.Wm)("code",null,"Vue"),(0,a.Uk)("源码是普遍认为可行的一种方式。")])]),(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Wm)("code",null,"src/compiler"),(0,a.Uk)("：此目录包含了与"),(0,a.Wm)("code",null,"Vue.js"),(0,a.Uk)("编译相关的代码，它包括：模板编译成 AST 抽象语法树、AST 抽象语法树优化和代码生成相关代码。编译的工作可以在构建时用"),(0,a.Wm)("code",null,"runtime-only"),(0,a.Uk)("版本，借助"),(0,a.Wm)("code",null,"webpack"),(0,a.Uk)("和"),(0,a.Wm)("code",null,"vue-loader"),(0,a.Uk)("等工具或插件来进行编译。也可以在运行时，使用包含构建功能的"),(0,a.Wm)("code",null,"runtime + compiler"),(0,a.Uk)("版本。显然，编译是一项比较消耗性能的工作，所以我们日常的开发中，更推荐使用"),(0,a.Wm)("code",null,"runtime-only"),(0,a.Uk)("的版本开发(体积也更小)，也就是通过"),(0,a.Wm)("code",null,".vue"),(0,a.Uk)("文件的形式开发。")])])],-1),u=(0,a.Wm)("div",{class:"language-javascript ext-js"},[(0,a.Wm)("pre",{class:"language-javascript"},[(0,a.Wm)("code",null,[(0,a.Wm)("span",{class:"token comment"},"// 需要使用带编译的版本"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token keyword"},"new"),(0,a.Uk)(),(0,a.Wm)("span",{class:"token class-name"},"Vue"),(0,a.Wm)("span",{class:"token punctuation"},"("),(0,a.Wm)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n  data"),(0,a.Wm)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a.Wm)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n    msg"),(0,a.Wm)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a.Wm)("span",{class:"token string"},"'hello,world'"),(0,a.Uk)("\n  "),(0,a.Wm)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n  template"),(0,a.Wm)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a.Wm)("span",{class:"token string"},"'<div>{{msg}}</div>'"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token punctuation"},"}"),(0,a.Wm)("span",{class:"token punctuation"},")"),(0,a.Uk)("\n\n"),(0,a.Wm)("span",{class:"token comment"},"// 不需要使用带编译的版本"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token keyword"},"new"),(0,a.Uk)(),(0,a.Wm)("span",{class:"token class-name"},"Vue"),(0,a.Wm)("span",{class:"token punctuation"},"("),(0,a.Wm)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n  data"),(0,a.Wm)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a.Wm)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n    msg"),(0,a.Wm)("span",{class:"token operator"},":"),(0,a.Uk)(),(0,a.Wm)("span",{class:"token string"},"'hello,world'"),(0,a.Uk)("\n  "),(0,a.Wm)("span",{class:"token punctuation"},"}"),(0,a.Wm)("span",{class:"token punctuation"},","),(0,a.Uk)("\n  "),(0,a.Wm)("span",{class:"token function"},"render"),(0,a.Uk)(),(0,a.Wm)("span",{class:"token punctuation"},"("),(0,a.Wm)("span",{class:"token parameter"},"h"),(0,a.Wm)("span",{class:"token punctuation"},")"),(0,a.Uk)(),(0,a.Wm)("span",{class:"token punctuation"},"{"),(0,a.Uk)("\n    "),(0,a.Wm)("span",{class:"token keyword"},"return"),(0,a.Uk)(),(0,a.Wm)("span",{class:"token function"},"h"),(0,a.Wm)("span",{class:"token punctuation"},"("),(0,a.Wm)("span",{class:"token string"},"'div'"),(0,a.Wm)("span",{class:"token punctuation"},","),(0,a.Uk)(),(0,a.Wm)("span",{class:"token keyword"},"this"),(0,a.Wm)("span",{class:"token punctuation"},"."),(0,a.Uk)("msg"),(0,a.Wm)("span",{class:"token punctuation"},")"),(0,a.Uk)("\n  "),(0,a.Wm)("span",{class:"token punctuation"},"}"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token punctuation"},"}"),(0,a.Wm)("span",{class:"token punctuation"},")"),(0,a.Uk)("\n")])])],-1),W=(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[(0,a.Wm)("code",null,"src/core"),(0,a.Uk)("：此目录包含了"),(0,a.Wm)("code",null,"Vue.js"),(0,a.Uk)("的核心代码，包括：内置组件"),(0,a.Wm)("code",null,"keep-alive"),(0,a.Uk)("、全局 API("),(0,a.Wm)("code",null,"Vue.use"),(0,a.Uk)("、"),(0,a.Wm)("code",null,"Vue.mixin"),(0,a.Uk)("和"),(0,a.Wm)("code",null,"Vue.extend"),(0,a.Uk)("等)、实例化、响应式相关、虚拟 DOM 和工具函数等。")])],-1),r=(0,a.Wm)("div",{class:"language-bash ext-sh"},[(0,a.Wm)("pre",{class:"language-bash"},[(0,a.Wm)("code",null,[(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- core\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("   "),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- components      "),(0,a.Wm)("span",{class:"token comment"},"# 内助组件"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("   "),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- global-api      "),(0,a.Wm)("span",{class:"token comment"},"# 全局API"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("   "),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- instance        "),(0,a.Wm)("span",{class:"token comment"},"# 实例化"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("   "),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- observer        "),(0,a.Wm)("span",{class:"token comment"},"# 响应式"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("   "),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- util            "),(0,a.Wm)("span",{class:"token comment"},"# 工具函数"),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("   "),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("-- vdom            "),(0,a.Wm)("span",{class:"token comment"},"# 虚拟DOM"),(0,a.Uk)("\n")])])],-1),U=(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[(0,a.Wm)("code",null,"src/platform"),(0,a.Uk)("："),(0,a.Wm)("code",null,"Vue2.0"),(0,a.Uk)("提供了跨平台的能力，在"),(0,a.Wm)("code",null,"React"),(0,a.Uk)("中有"),(0,a.Wm)("code",null,"React Native"),(0,a.Uk)("跨平台客户端，而在"),(0,a.Wm)("code",null,"Vue2.0"),(0,a.Uk)("中其对应的跨平台就是"),(0,a.Wm)("code",null,"Weex"),(0,a.Uk)("。")])],-1),d=(0,a.Wm)("div",{class:"language-javascript ext-js"},[(0,a.Wm)("pre",{class:"language-javascript"},[(0,a.Wm)("code",null,[(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Wm)("span",{class:"token operator"},"--"),(0,a.Uk)(" platform\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("   "),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Wm)("span",{class:"token operator"},"--"),(0,a.Uk)(" web      # web浏览器端\n"),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)("   "),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Wm)("span",{class:"token operator"},"--"),(0,a.Uk)(" weex     # native客户端\n")])])],-1),i=(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Wm)("code",null,"src/server"),(0,a.Uk)(": "),(0,a.Wm)("code",null,"Vue2.0"),(0,a.Uk)("提供服务端渲染的能力，所有跟服务端渲染相关的代码都在"),(0,a.Wm)("code",null,"server"),(0,a.Uk)("目录下，此部分代码是运行在服务端，而非 Web 浏览器端。")])]),(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Wm)("code",null,"src/sfc"),(0,a.Uk)("：此目录的主要作用是如何把"),(0,a.Wm)("code",null,".vue"),(0,a.Uk)("文件解析成一个"),(0,a.Wm)("code",null,"JavaScript"),(0,a.Uk)("对象。")])]),(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Wm)("code",null,"src/shared"),(0,a.Uk)("：此目录下存放了一些在 Web 浏览器端和服务端都会用到的共享代码。")])])],-1),v=(0,a.Wm)("h2",{id:"架构设计",tabindex:"-1"},[(0,a.Wm)("a",{class:"header-anchor",href:"#架构设计","aria-hidden":"true"},"#"),(0,a.Uk)(" 架构设计")],-1),g=(0,a.Wm)("p",null,[(0,a.Uk)("我们通过以上目录结构可以很容易的发现，"),(0,a.Wm)("code",null,"Vue.js"),(0,a.Uk)("整体分为三个部分："),(0,a.Wm)("strong",null,"核心代码"),(0,a.Uk)("、"),(0,a.Wm)("strong",null,"跨平台相关"),(0,a.Uk)("和"),(0,a.Wm)("strong",null,"公共工具函数"),(0,a.Uk)("。")],-1),h=(0,a.Wm)("p",null,[(0,a.Uk)("同时其架构是分层的，最底层是一个构造函数(普通的函数)，最上层是一个入口，也就是将一个完整的构造函数导出给用户使用。在中间层，我们需要逐渐添加一些方法和属性，主要是原型"),(0,a.Wm)("code",null,"prototype"),(0,a.Uk)("相关和全局API相关。")],-1),b=(0,a.Wm)("p",null,[(0,a.Wm)("img",{src:l,alt:"Vue架构设计"})],-1),V={render:function(n,e){return(0,a.wg)(),(0,a.j4)(a.HY,null,[o,t,m,c,k,p,u,W,r,U,d,i,v,g,h,b],64)}}}}]);